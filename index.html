<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espectro del S√≠ntoma Cu√°ntico - Automata Infinita</title>
    
    <!-- Fuentes de Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@300;400;600;700&family=JetBrains+Mono:wght@300;400&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    
    <!-- QR Code Generator -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <style>
        /* ===== VARIABLES Y RESET ===== */
        :root {
            --color-fondo: #0a0e17;
            --color-texto: #e2e8f0;
            --color-primario: #3b82f6;
            --color-secundario: #1e40af;
            --color-accento: #10b981;
            --color-peligro: #ef4444;
            --color-advertencia: #f59e0b;
            --color-rigor: #2c3e50;
            --color-especulacion: #f39c12;
            --color-oportunismo: #e74c3c;
            --color-comercial: #c0392b;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Crimson Pro', serif;
            background-color: var(--color-fondo);
            color: var(--color-texto);
            line-height: 1.7;
            padding: 20px;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(59, 130, 246, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(239, 68, 68, 0.05) 0%, transparent 20%);
        }
        
        /* ===== CONTENEDOR PRINCIPAL ===== */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(15, 23, 42, 0.9);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        /* ===== ENCABEZADO ===== */
        header {
            background: linear-gradient(135deg, #0c1a32 0%, #1a365d 100%);
            padding: 40px;
            border-bottom: 3px solid var(--color-primario);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(239, 68, 68, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }
        
        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3.2rem;
            color: #fff;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            letter-spacing: 0.5px;
            position: relative;
            z-index: 1;
        }
        
        .subtitle {
            font-size: 1.4rem;
            color: #a0c8ff;
            font-style: italic;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .author {
            color: #94a3b8;
            font-size: 1.1rem;
            border-left: 3px solid var(--color-primario);
            padding-left: 20px;
            margin-top: 20px;
            position: relative;
            z-index: 1;
        }
        
        /* ===== PESTA√ëAS ===== */
        .tabs {
            display: flex;
            background: #1e293b;
            border-bottom: 2px solid var(--color-primario);
            position: relative;
            z-index: 10;
            flex-wrap: wrap;
        }
        
        .tab-button {
            flex: 1;
            min-width: 120px;
            padding: 15px 10px;
            background: transparent;
            border: none;
            color: #cbd5e1;
            font-family: 'Crimson Pro', serif;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            text-align: center;
            letter-spacing: 0.3px;
        }
        
        .tab-button:hover {
            background: rgba(59, 130, 246, 0.1);
            color: var(--color-primario);
        }
        
        .tab-button.active {
            background: var(--color-primario);
            color: white;
            font-weight: 600;
        }
        
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: #fff;
        }
        
        /* Colores para las nuevas pesta√±as */
        .tab-button:nth-child(3) { /* Mapa */
            background: linear-gradient(90deg, #1e40af, #3b82f6);
            color: white;
        }
        .tab-button:nth-child(4) { /* L√≠nea de tiempo */
            background: linear-gradient(90deg, #0f766e, #14b8a6);
            color: white;
        }
        .tab-button:nth-child(5) { /* Radar */
            background: linear-gradient(90deg, #7c3aed, #8b5cf6);
            color: white;
        }
        .tab-button:nth-child(6) { /* Calculadora IDE */
            background: linear-gradient(90deg, #c2410c, #f97316);
            color: white;
        }
        
        /* ===== CONTENIDO DE PESTA√ëAS ===== */
        .tab-content {
            display: none;
            padding: 40px;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ===== GR√ÅFICOS ===== */
        .graph-container {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 40px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        .graph-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--color-primario), var(--color-accento));
            border-radius: 15px 15px 0 0;
        }
        
        .graph-title {
            color: var(--color-primario);
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(59, 130, 246, 0.3);
        }
        
        .graph-wrapper {
            width: 100%;
            height: 700px;
            border-radius: 10px;
            overflow: hidden;
            background: #0f172a;
        }
        
        /* ===== LEGENDA MEJORADA ===== */
        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
            padding: 25px;
            background: rgba(30, 41, 59, 0.6);
            border-radius: 12px;
            border-left: 5px solid var(--color-primario);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .legend-color {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .legend-text {
            flex: 1;
        }
        
        .legend-range {
            font-weight: bold;
            color: #fff;
            font-size: 1.1rem;
        }
        
        .legend-desc {
            color: #cbd5e1;
            font-size: 0.95rem;
        }
        
        /* ===== TABLA ===== */
        .table-container {
            overflow-x: auto;
            margin-top: 30px;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(30, 41, 59, 0.8);
        }
        
        th {
            background: #1e293b;
            color: var(--color-primario);
            padding: 20px 15px;
            text-align: left;
            font-weight: 600;
            font-family: 'Playfair Display', serif;
            border-bottom: 2px solid var(--color-primario);
        }
        
        td {
            padding: 18px 15px;
            border-bottom: 1px solid rgba(100, 116, 139, 0.3);
            transition: background 0.3s ease;
        }
        
        tr:hover td {
            background: rgba(59, 130, 246, 0.1);
        }
        
        tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.03);
        }
        
        /* ===== SECCI√ìN QR ===== */
        .qr-section {
            text-align: center;
            padding: 50px;
            margin-top: 40px;
            background: linear-gradient(135deg, rgba(12, 26, 50, 0.9) 0%, rgba(26, 54, 93, 0.9) 100%);
            border-radius: 20px;
            border: 2px solid var(--color-primario);
            position: relative;
            overflow: hidden;
        }
        
        .qr-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 10% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(16, 185, 129, 0.1) 0%, transparent 40%);
            pointer-events: none;
        }
        
        .qr-container {
            display: inline-block;
            padding: 25px;
            background: white;
            border-radius: 15px;
            margin: 25px 0;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
            position: relative;
            z-index: 2;
        }
        
        .url-display {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            margin: 20px auto;
            max-width: 600px;
            word-break: break-all;
            border: 1px solid var(--color-primario);
            position: relative;
            z-index: 2;
        }
        
        .copy-button {
            padding: 12px 30px;
            background: var(--color-primario);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Crimson Pro', serif;
            font-size: 1rem;
            transition: all 0.3s ease;
            margin-top: 10px;
            position: relative;
            z-index: 2;
        }
        
        .copy-button:hover {
            background: var(--color-secundario);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }
        
        /* ===== FOOTER ===== */
        footer {
            text-align: center;
            padding: 40px;
            margin-top: 40px;
            border-top: 1px solid rgba(100, 116, 139, 0.3);
            color: #94a3b8;
            font-size: 0.95rem;
            position: relative;
        }
        
        footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--color-primario), transparent);
        }
        
        /* ===== NOTAS Y TOOLTIPS ===== */
        .note {
            background: rgba(59, 130, 246, 0.1);
            border-left: 4px solid var(--color-primario);
            padding: 20px;
            margin: 25px 0;
            border-radius: 0 10px 10px 0;
            font-size: 1rem;
        }
        
        .note-title {
            color: var(--color-primario);
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 1024px) {
            h1 { font-size: 2.5rem; }
            .graph-wrapper { height: 600px; }
            .tabs { flex-direction: column; }
            .tab-button { padding: 15px; }
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            header { padding: 30px 20px; }
            h1 { font-size: 2rem; }
            .subtitle { font-size: 1.1rem; }
            .graph-wrapper { height: 500px; }
            .tab-content { padding: 20px; }
            .legend-grid { grid-template-columns: 1fr; }
        }
        
        /* ===== SCROLLBAR PERSONALIZADA ===== */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1e293b;
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--color-primario);
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--color-secundario);
        }
        
        /* ===== ESTILOS PARA LA CALCULADORA IDE ===== */
        #ideCalculatorApp textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        #ideCalculatorApp select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* Animaci√≥n para el indicador de IDE */
        @keyframes pulseIDE {
            0% { box-shadow: 0 0 5px white; }
            50% { box-shadow: 0 0 15px white; }
            100% { box-shadow: 0 0 5px white; }
        }
        
        #ideIndicator {
            animation: pulseIDE 2s infinite;
        }
        
        /* Estilos para checkboxes personalizados */
        #profileSelector input[type="checkbox"] {
            accent-color: #3b82f6;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        /* Estilos para el slider */
        input[type="range"] {
            -webkit-appearance: none;
            height: 8px;
            background: linear-gradient(90deg, #2c3e50, #e74c3c);
            border-radius: 4px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            background: #3b82f6;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
            cursor: pointer;
        }
        
        /* Animaciones para modales */
        @keyframes modalAppear {
            0% { opacity: 0; transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        div[style*="position: fixed; top: 0; left: 0; width: 100%"] > div {
            animation: modalAppear 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ENCABEZADO -->
        <header>
            <h1>üìä Espectro del S√≠ntoma Cu√°ntico</h1>
            <p class="subtitle">Visualizaci√≥n interactiva para el ensayo de Automata Infinita</p>
            <p class="subtitle">"El S√≠ntoma Cu√°ntico: Deseo, Met√°fora y B√∫squeda de Sentido en la Era Digital"</p>
            <p class="author">Investigaci√≥n cultural y an√°lisis epistemol√≥gico | Edici√≥n especial con datos extendidos</p>
        </header>
        
        <!-- PESTA√ëAS -->
        <div class="tabs">
            <button class="tab-button active" onclick="openTab('espectro3d')">üåå Espectro 3D</button>
            <button class="tab-button" onclick="openTab('influencias')">üï∏Ô∏è Red de Influencias</button>
            <button class="tab-button" onclick="openTab('mapa')">üó∫Ô∏è Mapa Geopol√≠tico</button>
            <button class="tab-button" onclick="openTab('timeline')">‚è≥ L√≠nea de Tiempo</button>
            <button class="tab-button" onclick="openTab('radar')">üìä Radar por Categor√≠a</button>
            <button class="tab-button" onclick="openTab('ideCalculator')">üßÆ Calculadora IDE</button>
            <button class="tab-button" onclick="openTab('tabla')">üìã Tabla Completa</button>
            <button class="tab-button" onclick="openTab('qr')">üîó Compartir</button>
        </div>
        
        <!-- PESTA√ëA 1: ESPECTRO 3D -->
        <div id="espectro3d" class="tab-content active">
            <div class="graph-container">
                <div class="graph-title">
                    üìà Espectro 3D del S√≠ntoma Cu√°ntico (1927-2024)
                </div>
                
                <div class="note">
                    <div class="note-title">üéØ C√≥mo leer este gr√°fico:</div>
                    <p><strong>Eje X (A√±o):</strong> Momento de m√°ximo impacto cultural del personaje.</p>
                    <p><strong>Eje Y (IDE):</strong> √çndice de Desviaci√≥n Epistemol√≥gica (0 = ciencia rigurosa, 10 = fabricaci√≥n completa).</p>
                    <p><strong>Eje Z (Alcance):</strong> Influencia cultural alcanzada (1 = nicho, 10 = global).</p>
                    <p><strong>Tama√±o del punto:</strong> Alcance cultural multiplicado.</p>
                    <p><strong>Color:</strong> Nivel de IDE (ver leyenda abajo).</p>
                </div>
                
                <div class="graph-wrapper" id="plot3d"></div>
            </div>
            
            <!-- LEGENDA MEJORADA -->
            <div class="legend-grid" id="legend3d">
                <!-- Se llena con JavaScript -->
            </div>
        </div>
        
        <!-- PESTA√ëA 2: RED DE INFLUENCIAS -->
        <div id="influencias" class="tab-content">
            <div class="graph-container">
                <div class="graph-title">
                    üï∏Ô∏è Red de Influencias: Qui√©n Aliment√≥ a Qui√©n
                </div>
                
                <div class="note">
                    <div class="note-title">üîç C√≥mo leer este gr√°fico:</div>
                    <p><strong>Nodos (rect√°ngulos):</strong> Personajes clave en la historia del s√≠ntoma.</p>
                    <p><strong>Flujos (conexiones):</strong> Direcci√≥n e intensidad de la influencia entre personajes.</p>
                    <p><strong>Ancho de conexi√≥n:</strong> Intensidad de la influencia (valor 1-10).</p>
                </div>
                
                <div class="graph-wrapper" id="plotSankey"></div>
            </div>
            
            <div class="note">
                <div class="note-title">‚ö° Din√°mica de contagio cultural:</div>
                <p>Este diagrama Sankey muestra c√≥mo las ideas migraron de un dominio a otro, transform√°ndose en el proceso. Observe c√≥mo el <strong>rigor austero de Copenhague</strong> (izquierda) se transforma en <strong>mercanc√≠a espiritual digital</strong> (derecha) a trav√©s de intermediarios clave. Las conexiones m√°s gruesas indican influencias m√°s determinantes en la evoluci√≥n del s√≠ntoma.</p>
            </div>
        </div>
        
        <!-- PESTA√ëA 3: MAPA GEOPOL√çTICO -->
        <div id="mapa" class="tab-content">
            <div class="graph-container">
                <div class="graph-title">
                    üó∫Ô∏è Mapa Geopol√≠tico del S√≠ntoma Cu√°ntico
                </div>
                
                <div class="note">
                    <div class="note-title">üåç C√≥mo leer este mapa:</div>
                    <p><strong>Color:</strong> √çndice de Desviaci√≥n Epistemol√≥gica (IDE) promedio por pa√≠s. M√°s rojo = mayor desviaci√≥n.</p>
                    <p><strong>Click o hover:</strong> Muestra detalles del s√≠ntoma en cada regi√≥n.</p>
                    <p><strong>Fuente:</strong> Cap√≠tulo 10 - Geograf√≠as del S√≠ntoma (Variantes Regionales).</p>
                </div>
                
                <div class="graph-wrapper" id="plotMapa"></div>
                
                <!-- LEGENDA PARA EL MAPA -->
                <div class="legend-grid" id="legendMapa" style="margin-top: 30px;">
                    <!-- Se llena con JavaScript -->
                </div>
            </div>
        </div>
        
        <!-- PESTA√ëA 4: L√çNEA DE TIEMPO -->
        <div id="timeline" class="tab-content">
            <div class="graph-container">
                <div class="graph-title">
                    ‚è≥ L√≠nea de Tiempo: Evoluci√≥n del S√≠ntoma Cu√°ntico (1927-2024)
                </div>
                
                <div class="note">
                    <div class="note-title">üï∞Ô∏è C√≥mo leer esta l√≠nea de tiempo:</div>
                    <p><strong>Posici√≥n horizontal:</strong> A√±o del evento.</p>
                    <p><strong>Posici√≥n vertical (altura):</strong> Impacto cultural (1-10).</p>
                    <p><strong>Color:</strong> Tipo de evento (ver leyenda).</p>
                    <p><strong>Tama√±o:</strong> Relevancia en la evoluci√≥n del s√≠ntoma.</p>
                    <p><strong>Slider:</strong> Arrastra para explorar d√©cadas espec√≠ficas.</p>
                </div>
                
                <!-- SLIDER PARA CONTROLAR EL RANGO DE A√ëOS -->
                <div style="margin: 30px 0; padding: 20px; background: rgba(30, 41, 59, 0.6); border-radius: 10px;">
                    <label style="color: #3b82f6; font-weight: bold; margin-right: 15px;">üîç Rango de a√±os:</label>
                    <input type="range" id="yearRange" min="1920" max="2030" value="1920" step="10" style="width: 80%;">
                    <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                        <span style="color: #94a3b8;">1920</span>
                        <span id="currentYear" style="color: #3b82f6; font-weight: bold;">1920-2030</span>
                        <span style="color: #94a3b8;">2030</span>
                    </div>
                </div>
                
                <div class="graph-wrapper" id="plotTimeline"></div>
                
                <!-- LEYENDA DE CATEGOR√çAS -->
                <div class="legend-grid" id="legendTimeline" style="margin-top: 30px;">
                    <!-- Se llena con JavaScript -->
                </div>
            </div>
        </div>
        
        <!-- PESTA√ëA 5: RADAR POR CATEGOR√çA -->
        <div id="radar" class="tab-content">
            <div class="graph-container">
                <div class="graph-title">
                    üìä An√°lisis Comparativo: Perfiles del S√≠ntoma Cu√°ntico
                </div>
                
                <div class="note">
                    <div class="note-title">üéØ C√≥mo leer los diagramas de radar:</div>
                    <p><strong>Radio (desde el centro):</strong> Valor en cada dimensi√≥n (0-10).</p>
                    <p><strong>√Årea total:</strong> Representa el "perfil" completo de cada categor√≠a.</p>
                    <p><strong>Forma:</strong> Patr√≥n caracter√≠stico de cada tipo de actor.</p>
                    <p><strong>Selector:</strong> Elige qu√© perfiles comparar (m√°ximo 3).</p>
                </div>
                
                <!-- SELECTOR DE PERFILES -->
                <div style="margin: 30px 0; padding: 20px; background: rgba(30, 41, 59, 0.6); border-radius: 10px;">
                    <div style="color: #3b82f6; font-weight: bold; margin-bottom: 15px;">üë• Selecciona perfiles para comparar:</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 20px;" id="profileSelector">
                        <!-- Se llena con JavaScript -->
                    </div>
                    <button id="compareButton" class="copy-button" style="margin-top: 10px;">üîç Comparar perfiles seleccionados</button>
                    <p id="comparisonFeedback" style="margin-top: 15px; color: #10b981; display: none;"></p>
                </div>
                
                <div class="graph-wrapper" id="plotRadar"></div>
                
                <!-- LEYENDA DE DIMENSIONES -->
                <div class="legend-grid" id="legendRadar" style="margin-top: 30px;">
                    <!-- Se llena con JavaScript -->
                </div>
            </div>
        </div>
        
        <!-- PESTA√ëA 6: CALCULADORA IDE -->
        <div id="ideCalculator" class="tab-content">
            <div class="graph-container">
                <div class="graph-title">
                    üßÆ Calculadora del √çndice de Desviaci√≥n Epistemol√≥gica
                </div>
                
                <div class="note">
                    <div class="note-title">‚öñÔ∏è Eval√∫a cualquier discurso "cu√°ntico":</div>
                    <p>Esta herramienta te permite calcular el IDE de cualquier discurso, libro o persona que use lenguaje "cu√°ntico".</p>
                    <p>Basado en los 5 criterios analizados en el ensayo:</p>
                    <ol style="margin-left: 20px; color: #cbd5e1;">
                        <li>Fidelidad a las matem√°ticas</li>
                        <li>Respeto al contexto experimental</li>
                        <li>Transparencia de intenciones</li>
                        <li>Grado de literalizaci√≥n metaf√≥rica</li>
                        <li>Impacto en la comprensi√≥n p√∫blica</li>
                    </ol>
                </div>
                
                <!-- INTERFAZ DE LA CALCULADORA -->
                <div id="ideCalculatorApp" style="padding: 30px; background: rgba(30, 41, 59, 0.6); border-radius: 15px; margin-top: 20px;">
                    <!-- ENTRADA DE TEXTO -->
                    <div style="margin-bottom: 30px;">
                        <label style="display: block; color: #3b82f6; font-weight: bold; margin-bottom: 10px;">üìù Ingresa un texto o frase para analizar:</label>
                        <textarea id="ideTextInput" rows="4" style="width: 100%; padding: 15px; background: #0f172a; border: 2px solid #334155; border-radius: 10px; color: #e2e8f0; font-family: 'Crimson Pro', serif; font-size: 16px;" placeholder="Ejemplo: 'Tus pensamientos crean tu realidad cu√°ntica' o 'El campo cu√°ntico conecta todas las almas'"></textarea>
                        <button onclick="analizarTextoIDE()" class="copy-button" style="margin-top: 15px;">üîç Analizar texto</button>
                    </div>
                    
                    <!-- SELECTOR DE CASOS PREDEFINIDOS -->
                    <div style="margin-bottom: 30px;">
                        <label style="display: block; color: #3b82f6; font-weight: bold; margin-bottom: 10px;">üìö O selecciona un caso predefinido:</label>
                        <select id="ideCaseSelect" style="width: 100%; padding: 12px; background: #0f172a; border: 2px solid #334155; border-radius: 10px; color: #e2e8f0; font-family: 'Crimson Pro', serif; font-size: 16px;" onchange="cargarCasoPredefinido(this.value)">
                            <option value="">-- Selecciona un caso del ensayo --</option>
                            <option value="chopra">Deepak Chopra: "La curaci√≥n cu√°ntica"</option>
                            <option value="dispenza">Joe Dispenza: "Meditaci√≥n cu√°ntica"</option>
                            <option value="capra">Fritjof Capra: "El Tao de la F√≠sica"</option>
                            <option value="zohar">Danah Zohar: "El Yo Cu√°ntico"</option>
                            <option value="bohr">Niels Bohr: Interpretaci√≥n de Copenhague</option>
                            <option value="twitter">Tweet viral: "La f√≠sica cu√°ntica confirma..."</option>
                        </select>
                    </div>
                    
                    <!-- RESULTADO -->
                    <div id="ideResult" style="display: none; padding: 25px; background: rgba(15, 23, 42, 0.8); border-radius: 12px; margin-top: 30px; border-left: 5px solid #3b82f6;">
                        <h3 style="color: #3b82f6; margin-bottom: 20px;">üìä Resultado del an√°lisis:</h3>
                        
                        <!-- BARRA DE IDE -->
                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="color: #94a3b8;">IDE calculado:</span>
                                <span id="ideScore" style="color: #fff; font-weight: bold; font-size: 1.2rem;">0/10</span>
                            </div>
                            <div style="height: 30px; background: linear-gradient(90deg, #2c3e50, #3498db, #f39c12, #e74c3c, #c0392b); border-radius: 15px; position: relative;">
                                <div id="ideIndicator" style="position: absolute; top: -5px; width: 4px; height: 40px; background: white; border-radius: 2px; box-shadow: 0 0 10px white; transition: left 1s ease;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 0.9rem; color: #94a3b8;">
                                <span>0 (Ciencia)</span>
                                <span>10 (Fabricaci√≥n)</span>
                            </div>
                        </div>
                        
                        <!-- CATEGOR√çA -->
                        <div style="margin-bottom: 25px;">
                            <div style="color: #94a3b8; margin-bottom: 5px;">Categor√≠a:</div>
                            <div id="ideCategory" style="padding: 10px 15px; border-radius: 8px; font-weight: bold; display: inline-block;"></div>
                        </div>
                        
                        <!-- DESGLOSE POR DIMENSIONES -->
                        <div style="margin-bottom: 25px;">
                            <div style="color: #94a3b6; margin-bottom: 15px;">üìà Desglose por dimensiones:</div>
                            <div id="ideDimensions" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <!-- Se llena con JavaScript -->
                            </div>
                        </div>
                        
                        <!-- AN√ÅLISIS DETALLADO -->
                        <div>
                            <div style="color: #94a3b8; margin-bottom: 10px;">üìñ An√°lisis detallado:</div>
                            <div id="ideAnalysis" style="padding: 15px; background: rgba(0,0,0,0.3); border-radius: 8px; color: #cbd5e1; line-height: 1.6;"></div>
                        </div>
                    </div>
                    
                    <!-- EJEMPLOS DE USO -->
                    <div class="note" style="margin-top: 30px;">
                        <div class="note-title">üí° Ejemplos para probar:</div>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px;">
                            <button onclick="cargarEjemplo('ej1')" class="copy-button" style="background: rgba(59, 130, 246, 0.2); font-size: 0.9rem; padding: 8px 12px;">
                                "Tus pensamientos crean tu realidad"
                            </button>
                            <button onclick="cargarEjemplo('ej2')" class="copy-button" style="background: rgba(239, 68, 68, 0.2); font-size: 0.9rem; padding: 8px 12px;">
                                "El campo cu√°ntico conecta todas las almas"
                            </button>
                            <button onclick="cargarEjemplo('ej3')" class="copy-button" style="background: rgba(16, 185, 129, 0.2); font-size: 0.9rem; padding: 8px 12px;">
                                "La observaci√≥n afecta lo observado"
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- PESTA√ëA 7: TABLA COMPLETA -->
        <div id="tabla" class="tab-content">
            <div class="graph-container">
                <div class="graph-title">
                    üìã Cat√°logo Completo del S√≠ntoma
                </div>
                
                <div class="table-container">
                    <table id="completeTable">
                        <thead>
                            <tr>
                                <th>Personaje</th>
                                <th>A√±o Pico</th>
                                <th>IDE</th>
                                <th>Alcance</th>
                                <th>Categor√≠a</th>
                                <th>Contexto</th>
                                <th>Rol/Contribuci√≥n</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- La tabla se llenar√° con JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="note">
                <div class="note-title">üìù Notas sobre la tabla:</div>
                <p>Esta tabla representa el <strong>universo de personajes analizados</strong> en el ensayo. No es exhaustiva (el fen√≥meno tiene miles de actores), pero incluye los nodos m√°s significativos en la genealog√≠a del s√≠ntoma. Los datos reflejan an√°lisis cultural y no pretenden ser juicios legales sobre intencionalidad individual.</p>
            </div>
        </div>
        
        <!-- PESTA√ëA 8: QR Y COMPARTIR -->
        <div id="qr" class="tab-content">
            <div class="graph-container">
                <div class="graph-title">
                    üîó Compartir esta Visualizaci√≥n
                </div>
                
                <div class="qr-section">
                    <p style="font-size: 1.2rem; margin-bottom: 20px; color: #a0c8ff;">
                        Escanea este c√≥digo QR para acceder a esta visualizaci√≥n interactiva desde cualquier dispositivo m√≥vil.
                    </p>
                    
                    <div class="qr-container">
                        <div id="qrcode"></div>
                    </div>
                    
                    <div style="margin: 30px 0;">
                        <p style="color: #fff; font-weight: bold; margin-bottom: 15px; font-size: 1.1rem;">
                            üìã URL directa:
                        </p>
                        <div class="url-display" id="urlDisplay">Cargando URL...</div>
                        
                        <button onclick="copyURL()" class="copy-button">
                            üìã Copiar URL al portapapeles
                        </button>
                        
                        <p id="copyFeedback" style="margin-top: 15px; color: #10b981; display: none;">
                            ‚úÖ ¬°URL copiada al portapapeles!
                        </p>
                    </div>
                    
                    <div class="note" style="background: rgba(255, 255, 255, 0.1); max-width: 800px; margin: 0 auto;">
                        <div class="note-title">üåê Uso acad√©mico y citaci√≥n:</div>
                        <p>Si utilizas estas visualizaciones en trabajos acad√©micos o publicaciones, por favor cita como:</p>
                        <p style="font-family: 'JetBrains Mono', monospace; background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; margin-top: 15px; font-size: 0.95rem;">
                            Automata Infinita. (2024). <em>Visualizaci√≥n del Espectro del S√≠ntoma Cu√°ntico</em>. Recuperado de [URL actual]
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- FOOTER -->
        <footer>
            <p>¬© 2024 Automata Infinita - "El S√≠ntoma Cu√°ntico: Deseo, Met√°fora y B√∫squeda de Sentido en la Era Digital"</p>
            <p style="margin-top: 10px; color: #64748b; font-size: 0.9rem;">
                Esta visualizaci√≥n acompa√±a al ensayo de investigaci√≥n cultural. Los datos representan an√°lisis epistemol√≥gico y no pretenden ser juicios legales.
            </p>
            <p style="margin-top: 20px;">
                <a href="javascript:void(0)" onclick="openTab('espectro3d')" style="color: #3b82f6; text-decoration: none; margin: 0 10px;">üåå 3D</a> | 
                <a href="javascript:void(0)" onclick="openTab('influencias')" style="color: #3b82f6; text-decoration: none; margin: 0 10px;">üï∏Ô∏è Red</a> | 
                <a href="javascript:void(0)" onclick="openTab('mapa')" style="color: #3b82f6; text-decoration: none; margin: 0 10px;">üó∫Ô∏è Mapa</a> | 
                <a href="javascript:void(0)" onclick="openTab('timeline')" style="color: #3b82f6; text-decoration: none; margin: 0 10px;">‚è≥ Tiempo</a> | 
                <a href="javascript:void(0)" onclick="openTab('radar')" style="color: #3b82f6; text-decoration: none; margin: 0 10px;">üìä Radar</a> | 
                <a href="javascript:void(0)" onclick="openTab('ideCalculator')" style="color: #3b82f6; text-decoration: none; margin: 0 10px;">üßÆ IDE</a> | 
                <a href="javascript:void(0)" onclick="openTab('tabla')" style="color: #3b82f6; text-decoration: none; margin: 0 10px;">üìã Tabla</a> | 
                <a href="javascript:void(0)" onclick="openTab('qr')" style="color: #3b82f6; text-decoration: none; margin: 0 10px;">üîó Compartir</a>
            </p>
            <p style="margin-top: 15px; font-size: 0.85rem; color: #475569;">
                Visualizaci√≥n creada con Plotly.js | Publicaci√≥n recomendada: GitHub Pages | Fuentes: Google Fonts
            </p>
        </footer>
    </div>

    <script>
        // ================================================
        // CONFIGURACI√ìN INICIAL
        // ================================================
        
        // Paleta de colores por IDE (√çndice de Desviaci√≥n Epistemol√≥gica)
        const colorPalette = {
            0: '#2c3e50',   // Rigor cient√≠fico
            2: '#3498db',   // Divulgaci√≥n leg√≠tima
            4: '#f39c12',   // Especulaci√≥n problem√°tica
            6: '#e74c3c',   // Oportunismo espiritual
            8: '#c0392b',   // Comercializaci√≥n
            10: '#7b241c'   // Fabricaci√≥n total
        };
        
        // Funci√≥n para obtener color por IDE
        function getColorByIDE(ide) {
            if (ide <= 2) return colorPalette[0];
            if (ide <= 4) return colorPalette[2];
            if (ide <= 6) return colorPalette[4];
            if (ide <= 8) return colorPalette[6];
            if (ide <= 10) return colorPalette[8];
            return colorPalette[10];
        }
        
        // Funci√≥n de jitter mejorada (sin superposiciones)
        function calcularJitter(personaje, index) {
            // Crear un hash √∫nico basado en el nombre
            const nombreHash = personaje.nombre.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
            
            // Jitter en X (a√±o): ¬±0.8 a√±os
            const jitterX = (nombreHash % 200) / 200 - 0.5;
            
            // Jitter en Y (IDE): ¬±0.4 puntos
            const jitterY = ((nombreHash * 17) % 200) / 200 - 0.5;
            
            // Jitter en Z (alcance): ¬±0.3 puntos
            const jitterZ = ((nombreHash * 31) % 200) / 200 - 0.5;
            
            return {
                x: personaje.a√±o + jitterX * 0.8,
                y: personaje.ide + jitterY * 0.4,
                z: personaje.alcance + jitterZ * 0.3
            };
        }
        
        // ================================================
        // DATOS COMPLETOS - TODOS LOS PERSONAJES
        // ================================================
        
        const personajes = [
            // === FUNDADORES / CIENCIA RIGUROSA ===
            {id: 0, nombre: "Niels Bohr", a√±o: 1927, ide: 0.5, alcance: 3, categoria: "Cient√≠fico fundador", contexto: "Dinamarca", rol: "Interpretaci√≥n de Copenhague"},
            {id: 1, nombre: "Werner Heisenberg", a√±o: 1927, ide: 0.5, alcance: 3, categoria: "Cient√≠fico fundador", contexto: "Alemania", rol: "Principio de incertidumbre"},
            
            // === PRECURSORES CULTURALES ===
            {id: 2, nombre: "Alan Watts", a√±o: 1960, ide: 2, alcance: 8, categoria: "Popularizador m√≠stico", contexto: "EEUU/Reino Unido", rol: "Puente Oriente/Occidente"},
            {id: 3, nombre: "Gregory Bateson", a√±o: 1970, ide: 2.5, alcance: 7, categoria: "Pensador sist√©mico", contexto: "EEUU/Reino Unido", rol: "Ecolog√≠a de la mente"},
            
            // === CONTRACULTURA CALIFORNIANA ===
            {id: 4, nombre: "Fritjof Capra", a√±o: 1975, ide: 5, alcance: 8, categoria: "Traductor po√©tico", contexto: "Austria/EEUU", rol: "El Tao de la F√≠sica"},
            {id: 5, nombre: "Jack Sarfatti", a√±o: 1975, ide: 6.2, alcance: 5, categoria: "F√≠sico marginal", contexto: "EEUU", rol: "Telepat√≠a cu√°ntica"},
            {id: 6, nombre: "Fred Alan Wolf", a√±o: 1975, ide: 6.8, alcance: 5, categoria: "F√≠sico marginal", contexto: "EEUU", rol: "El Universo So√±ado"},
            
            // === OPORTUNISTAS ESPIRITUALES ===
            {id: 7, nombre: "Timothy Leary", a√±o: 1970, ide: 7.5, alcance: 8, categoria: "Oportunista espiritual", contexto: "EEUU", rol: "Psicodelia y cu√°ntica"},
            {id: 8, nombre: "Richard Alpert (Ram Dass)", a√±o: 1971, ide: 7.2, alcance: 7, categoria: "Oportunista espiritual", contexto: "EEUU", rol: "Psicolog√≠a + espiritualidad"},
            {id: 9, nombre: "Maharishi Mahesh Yogi", a√±o: 1975, ide: 6.5, alcance: 8, categoria: "Cientifista m√≠stico", contexto: "India/Global", rol: "TM + estudios cu√°nticos"},
            
            // === COMERCIALIZACI√ìN (80s-90s) ===
            {id: 10, nombre: "Werner Erhard", a√±o: 1978, ide: 7.5, alcance: 8, categoria: "Instrumentalista", contexto: "EEUU", rol: "est - Iluminaci√≥n industrial"},
            {id: 11, nombre: "Danah Zohar", a√±o: 1990, ide: 5.5, alcance: 7, categoria: "Especuladora acad√©mica", contexto: "EEUU/Reino Unido", rol: "El Yo Cu√°ntico"},
            {id: 12, nombre: "Deepak Chopra", a√±o: 2000, ide: 9, alcance: 10, categoria: "Estratega comercial", contexto: "India/EEUU", rol: "Imperio wellness cu√°ntico"},
            
            // === SIGLO XXI - ESPECULADORES ===
            {id: 13, nombre: "Joe Dispenza", a√±o: 2015, ide: 8.5, alcance: 9, categoria: "Neurocu√°ntico", contexto: "EEUU", rol: "Meditaci√≥n + plasticidad cerebral"},
            {id: 14, nombre: "Gregg Braden", a√±o: 2010, ide: 7.5, alcance: 8, categoria: "Espiritualista c√≥smico", contexto: "EEUU", rol: "El campo divino"},
            {id: 15, nombre: "Bruce Lipton", a√±o: 2005, ide: 6.5, alcance: 7, categoria: "Bi√≥logo especulativo", contexto: "EEUU", rol: "Biolog√≠a de la creencia"},
            {id: 16, nombre: "Lynne McTaggart", a√±o: 2007, ide: 5.5, alcance: 6, categoria: "Periodista cient√≠fica", contexto: "EEUU", rol: "El Campo - experimentos"},
            {id: 17, nombre: "Amit Goswami", a√±o: 2005, ide: 5.5, alcance: 6, categoria: "Acad√©mico idealista", contexto: "India/EEUU", rol: "Idealismo cu√°ntico"},
            
            // === LATINOAM√âRICA ===
            {id: 18, nombre: "Claudio Mar√≠a Dom√≠nguez", a√±o: 2015, ide: 8, alcance: 7, categoria: "New age medi√°tico", contexto: "Argentina", rol: "Sincretismo cat√≥lico-new age-cu√°ntico"},
            {id: 19, nombre: "M√°ximo Rabino", a√±o: 2018, ide: 7.5, alcance: 5, categoria: "Cabalista", contexto: "Argentina", rol: "C√°bala + f√≠sica moderna"},
            {id: 20, nombre: "V√≠ctor Brossa", a√±o: 2015, ide: 8.2, alcance: 6, categoria: "Artista sanador", contexto: "Espa√±a/Argentina", rol: "Sanaci√≥n cu√°ntica"},
            
            // === DIGITAL NATIVO ===
            {id: 21, nombre: "Influencer promedio", a√±o: 2023, ide: 9.5, alcance: 7, categoria: "Viralizador digital", contexto: "Global", rol: "Coaching digital - manifestaci√≥n"}
        ];
        
        // ================================================
        // PREPARAR DATOS PARA GR√ÅFICO 3D
        // ================================================
        
        const datosGrafico = personajes.map((p, i) => {
            const jitter = calcularJitter(p, i);
            return {
                x: jitter.x,
                y: jitter.y,
                z: jitter.z,
                nombre: p.nombre,
                a√±o: p.a√±o,
                ide: p.ide,
                alcance: p.alcance,
                categoria: p.categoria,
                contexto: p.contexto,
                rol: p.rol,
                color: getColorByIDE(p.ide),
                size: Math.max(15, p.alcance * 4)
            };
        });
        
        // ================================================
        // GR√ÅFICO 3D MEJORADO
        // ================================================
        
        const trace3d = {
            x: datosGrafico.map(d => d.x),
            y: datosGrafico.map(d => d.y),
            z: datosGrafico.map(d => d.z),
            mode: 'markers+text',
            type: 'scatter3d',
            marker: {
                size: datosGrafico.map(d => d.size),
                color: datosGrafico.map(d => d.color),
                opacity: 0.9,
                symbol: 'circle',
                line: { color: 'white', width: 1.5 }
            },
            text: datosGrafico.map(d => d.nombre),
            textposition: 'top center',
            textfont: { 
                size: 12, 
                color: datosGrafico.map(d => d.ide > 7 ? '#fff' : '#333'),
                family: 'Crimson Pro, serif'
            },
            hovertemplate: `
                <b>%{text}</b><br>
                <br>
                <b>A√±o:</b> %{customdata.a√±o}<br>
                <b>IDE:</b> %{customdata.ide}/10<br>
                <b>Alcance:</b> %{customdata.alcance}/10<br>
                <br>
                <b>Contexto:</b> %{customdata.contexto}<br>
                <b>Categor√≠a:</b> %{customdata.categoria}<br>
                <br>
                <i>%{customdata.rol}</i>
                <extra></extra>
            `,
            customdata: datosGrafico.map(d => ({
                a√±o: d.a√±o,
                ide: d.ide.toFixed(1),
                alcance: d.alcance,
                contexto: d.contexto,
                categoria: d.categoria,
                rol: d.rol
            }))
        };
        
        const layout3d = {
            title: {
                text: 'ESPECTRO 3D: DEL RIGOR A LA MALVERSACI√ìN (1927-2024)',
                font: { 
                    color: '#3b82f6', 
                    size: 26,
                    family: 'Playfair Display, serif'
                }
            },
            scene: {
                xaxis: { 
                    title: { 
                        text: 'A√ëO DE IMPACTO CULTURAL', 
                        font: { color: '#e2e8f0', size: 16, family: 'Crimson Pro, serif' }
                    },
                    range: [1910, 2030],
                    gridcolor: '#334155',
                    color: '#94a3b8',
                    backgroundcolor: '#0f172a',
                    tickvals: [1927, 1960, 1975, 1990, 2005, 2020, 2025],
                    ticktext: ['1927<br>Copenhague', '1960<br>Watts', '1975<br>Capra', '1990<br>Zohar', '2005<br>Lipton', '2020<br>Digital', '2025<br>Futuro']
                },
                yaxis: { 
                    title: { 
                        text: '√çNDICE DE DESVIACI√ìN EPISTEMOL√ìGICA (IDE)', 
                        font: { color: '#e2e8f0', size: 16, family: 'Crimson Pro, serif' }
                    },
                    range: [0, 10.5],
                    gridcolor: '#334155',
                    color: '#94a3b8',
                    backgroundcolor: '#0f172a',
                    tickvals: [0, 2, 4, 6, 8, 10],
                    ticktext: ['RIGOR<br>CIENT√çFICO', 'DIVULGACI√ìN', 'ESPECULACI√ìN', 'OPORTUNISMO', 'COMERCIAL', 'FABRICACI√ìN']
                },
                zaxis: { 
                    title: { 
                        text: 'ALCANCE CULTURAL (1-10)', 
                        font: { color: '#e2e8f0', size: 16, family: 'Crimson Pro, serif' }
                    },
                    range: [0, 11],
                    gridcolor: '#334155',
                    color: '#94a3b8',
                    backgroundcolor: '#0f172a'
                },
                bgcolor: '#0f172a',
                camera: { 
                    eye: { x: 1.8, y: 1.8, z: 1.3 },
                    up: { x: 0, y: 0, z: 1 },
                    center: { x: 0, y: 0, z: 0 }
                }
            },
            margin: { l: 0, r: 0, b: 0, t: 100 },
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            hovermode: 'closest',
            showlegend: false
        };
        
        // ================================================
        // RED DE INFLUENCIAS (SANKEY)
        // ================================================
        
        const nodosSankey = [
            { nombre: "Niels Bohr", categoria: "Cient√≠fico fundador" },
            { nombre: "Alan Watts", categoria: "Popularizador m√≠stico" },
            { nombre: "Fritjof Capra", categoria: "Traductor po√©tico" },
            { nombre: "Jack Sarfatti", categoria: "F√≠sico marginal" },
            { nombre: "Timothy Leary", categoria: "Oportunista espiritual" },
            { nombre: "Maharishi Mahesh Yogi", categoria: "Cientifista m√≠stico" },
            { nombre: "Werner Erhard", categoria: "Instrumentalista" },
            { nombre: "Danah Zohar", categoria: "Especuladora acad√©mica" },
            { nombre: "Deepak Chopra", categoria: "Estratega comercial" },
            { nombre: "Joe Dispenza", categoria: "Neurocu√°ntico" },
            { nombre: "Claudio M. Dom√≠nguez", categoria: "New age medi√°tico" },
            { nombre: "Influencer promedio", categoria: "Viralizador digital" }
        ];
        
        const traceSankey = {
            type: "sankey",
            orientation: "h",
            node: {
                pad: 20,
                thickness: 25,
                line: { color: "black", width: 0.8 },
                label: nodosSankey.map(n => n.nombre),
                color: nodosSankey.map(n => {
                    const persona = personajes.find(p => p.nombre.includes(n.nombre.split(' ')[0]));
                    return persona ? getColorByIDE(persona.ide) : '#7f8c8d';
                }),
                hoverinfo: 'all',
                hovertemplate: '<b>%{label}</b><extra></extra>'
            },
            link: {
                source: [0, 0, 1, 2, 3, 4, 5, 6, 8, 9, 10],
                target: [2, 7, 8, 8, 8, 9, 9, 9, 10, 10, 11],
                value: [5, 3, 4, 6, 5, 4, 3, 6, 7, 8, 9],
                color: 'rgba(100, 100, 100, 0.3)',
                hovertemplate: 'Influencia: %{value}/10<extra></extra>'
            },
            textfont: { color: '#e2e8f0', size: 13, family: 'Crimson Pro, serif' }
        };
        
        const layoutSankey = {
            title: {
                text: "RED DE INFLUENCIAS CLAVE EN LA EVOLUCI√ìN DEL S√çNTOMA",
                font: { color: '#3b82f6', size: 24, family: 'Playfair Display, serif' }
            },
            font: { color: '#e2e8f0', size: 13, family: 'Crimson Pro, serif' },
            width: 1200,
            height: 700,
            margin: { l: 50, r: 50, b: 50, t: 90 },
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)'
        };
        
        // ================================================
        // DATOS PARA EL MAPA GEOPOL√çTICO
        // ================================================
        
        const datosMapa = [
            {pais: "Argentina", codigo: "ARG", ide_promedio: 7.2, caracteristica: "Sincretismo cat√≥lico-new age", 
             casos: ["Claudio Mar√≠a Dom√≠nguez", "M√°ximo Rabino", "V√≠ctor Brossa"], cap: "Cap. 10 - Latinoam√©rica"},
            
            {pais: "Estados Unidos", codigo: "USA", ide_promedio: 6.8, caracteristica: "Mercantilizaci√≥n wellness", 
             casos: ["Deepak Chopra", "Joe Dispenza", "Timothy Leary", "Gregg Braden"], cap: "Cap. 2, 7"},
            
            {pais: "India", codigo: "IND", ide_promedio: 6.5, caracteristica: "Reimportaci√≥n con credenciales", 
             casos: ["Maharishi Mahesh Yogi", "Amit Goswami", "Deepak Chopra"], cap: "Cap. 10 - Asia"},
            
            {pais: "Alemania", codigo: "DEU", ide_promedio: 5.2, caracteristica: "Sistematizaci√≥n burocr√°tica", 
             casos: ["R√ºdiger Dahlke", "Estudios acad√©micos 'light'"], cap: "Cap. 10 - Europa"},
            
            {pais: "Brasil", codigo: "BRA", ide_promedio: 7.5, caracteristica: "Sincretismo religioso masivo", 
             casos: ["Jos√© Trigueirinho", "Movimiento esp√≠rita-cu√°ntico"], cap: "Cap. 10 - Latinoam√©rica"},
            
            {pais: "Rusia", codigo: "RUS", ide_promedio: 6.9, caracteristica: "Post-sovi√©tico m√≠stico", 
             casos: ["Vadim Zeland (Transurfing)", "F√≠sica cu√°ntica esot√©rica"], cap: "Cap. 10 - Postsovi√©tico"},
            
            {pais: "Jap√≥n", codigo: "JPN", ide_promedio: 5.8, caracteristica: "Estetizaci√≥n del vac√≠o", 
             casos: ["Aplicaci√≥n Kokoro", "Libro 'Quantum Wa'"], cap: "Cap. 10 - Asia"},
            
            {pais: "Francia", codigo: "FRA", ide_promedio: 5.5, caracteristica: "Resistencia intelectual", 
             casos: ["Bernard Werber", "Cr√≠tica posmoderna"], cap: "Cap. 10 - Europa"},
            
            {pais: "Sud√°frica", codigo: "ZAF", ide_promedio: 6.0, caracteristica: "Descolonizaci√≥n epistemol√≥gica", 
             casos: ["Mogobe Ramose", "Ubuntu cu√°ntico"], cap: "Cap. 10 - √Åfrica"},
            
            {pais: "M√©xico", codigo: "MEX", ide_promedio: 7.0, caracteristica: "Arraigo territorial", 
             casos: ["Temazcal cu√°ntico", "Chamanismo digital"], cap: "Cap. 10 - Latinoam√©rica"},
            
            {pais: "Reino Unido", codigo: "GBR", ide_promedio: 6.2, caracteristica: "New Age acad√©mico", 
             casos: ["Danah Zohar", "Revistas de espiritualidad"], cap: "Cap. 2, 3"},
            
            {pais: "Australia", codigo: "AUS", ide_promedio: 6.5, caracteristica: "Espiritualidad ecol√≥gica", 
             casos: ["Retiros wellness", "Fusi√≥n new age-ecologismo"], cap: "Cap. 10 - Global"},
            
            {pais: "Espa√±a", codigo: "ESP", ide_promedio: 6.8, caracteristica: "Fusi√≥n new age-mediterr√°nea", 
             casos: ["V√≠ctor Brossa", "Enric Corbera (Biodescodificaci√≥n)"], cap: "Cap. 10 - Europa"}
        ];
        
        // Funci√≥n para obtener color por IDE (para el mapa)
        function getColorForMap(ide) {
            if (ide <= 4) return '#2c3e50';     // Azul oscuro: bajo IDE
            if (ide <= 6) return '#f39c12';     // Naranja: medio
            if (ide <= 8) return '#e74c3c';     // Rojo: alto
            return '#c0392b';                   // Rojo oscuro: muy alto
        }
        
        // ================================================
        // CREAR MAPA GEOPOL√çTICO
        // ================================================
        
        let mapaCreado = false;
        
        function crearMapa() {
            if (mapaCreado) return;
            
            // Generar arrays para Plotly
            const locations = datosMapa.map(d => d.codigo);
            const z = datosMapa.map(d => d.ide_promedio);
            const text = datosMapa.map(d => 
                `<b>${d.pais}</b><br>` +
                `<b>IDE promedio:</b> ${d.ide_promedio}/10<br>` +
                `<b>Caracter√≠stica:</b> ${d.caracteristica}<br>` +
                `<b>Casos emblem√°ticos:</b> ${d.casos.join(', ')}<br>` +
                `<b>Fuente en ensayo:</b> ${d.cap}<br>` +
                `<i>Click para m√°s detalles</i>`
            );
            
            const traceMapa = {
                type: 'choropleth',
                locationmode: 'ISO-3',
                locations: locations,
                z: z,
                text: text,
                hoverinfo: 'text',
                colorscale: [
                    [0, '#2c3e50'],    // Rigor cient√≠fico (bajo IDE)
                    [0.33, '#3498db'], // Divulgaci√≥n
                    [0.66, '#f39c12'], // Especulaci√≥n
                    [1, '#c0392b']     // Fabricaci√≥n (alto IDE)
                ],
                showscale: true,
                colorbar: {
                    title: 'IDE promedio',
                    thickness: 20,
                    len: 0.75,
                    tickvals: [4, 6, 8, 10],
                    ticktext: ['Bajo (4)', 'Medio (6)', 'Alto (8)', 'Muy alto (10)']
                },
                marker: {
                    line: {
                        color: '#0f172a',
                        width: 1
                    }
                }
            };
            
            const layoutMapa = {
                title: {
                    text: 'DISTRIBUCI√ìN GLOBAL DEL S√çNTOMA CU√ÅNTICO (2024)',
                    font: { 
                        color: '#3b82f6', 
                        size: 26,
                        family: 'Playfair Display, serif'
                    }
                },
                geo: {
                    showframe: false,
                    showcoastlines: true,
                    projection: {
                        type: 'natural earth'
                    },
                    bgcolor: 'rgba(0,0,0,0)',
                    landcolor: '#1e293b',
                    coastlinecolor: '#475569',
                    lakecolor: '#0f172a',
                    oceancolor: '#0f172a',
                    countrycolor: '#475569',
                    countrywidth: 1,
                    showcountries: true,
                    showocean: true,
                    showland: true,
                    showlakes: true,
                    showrivers: false,
                    lataxis: {range: [-55, 70]},
                    lonaxis: {range: [-180, 180]}
                },
                margin: { l: 0, r: 0, b: 0, t: 80 },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                width: 1200,
                height: 700,
                dragmode: false
            };
            
            Plotly.newPlot('plotMapa', [traceMapa], layoutMapa, { 
                responsive: true,
                displayModeBar: true,
                modeBarButtonsToRemove: ['lasso2d', 'select2d']
            });
            
            mapaCreado = true;
            
            // Generar leyenda para el mapa
            generarLeyendaMapa();
            
            // Agregar interactividad
            document.getElementById('plotMapa').on('plotly_click', function(data) {
                const punto = data.points[0];
                const paisIndex = locations.indexOf(punto.location);
                const paisData = datosMapa[paisIndex];
                
                mostrarModalPais(paisData);
            });
        }
        
        // ================================================
        // FUNCI√ìN PARA GENERAR LEYENDA DEL MAPA
        // ================================================
        
        function generarLeyendaMapa() {
            const legendContainer = document.getElementById('legendMapa');
            const legendData = [
                { rango: "IDE 0-4", desc: "Baja penetraci√≥n / Rigor cient√≠fico", color: '#2c3e50', ejemplos: "Alemania, Francia" },
                { rango: "IDE 4-6", desc: "Penetraci√≥n moderada / Especulaci√≥n acad√©mica", color: '#3498db', ejemplos: "Jap√≥n, Reino Unido" },
                { rango: "IDE 6-8", desc: "Alta penetraci√≥n / Oportunismo espiritual", color: '#f39c12', ejemplos: "EEUU, India, Espa√±a" },
                { rango: "IDE 8-10", desc: "Penetraci√≥n muy alta / Fabricaci√≥n masiva", color: '#c0392b', ejemplos: "Argentina, Brasil, Rusia" }
            ];
            
            legendContainer.innerHTML = legendData.map(item => `
                <div class="legend-item">
                    <div class="legend-color" style="background-color: ${item.color};"></div>
                    <div class="legend-text">
                        <div class="legend-range">${item.rango}</div>
                        <div class="legend-desc">
                            ${item.desc}<br>
                            <small style="color: #94a3b8; font-size: 0.85rem;">Ejemplos: ${item.ejemplos}</small>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // ================================================
        // DATOS PARA LA L√çNEA DE TIEMPO
        // ================================================
        
        const hitos = [
            // === FUNDACI√ìN CIENT√çFICA ===
            {a√±o: 1927, evento: "Interpretaci√≥n de Copenhague", impacto: 3, tipo: "ciencia", 
             desc: "Bohr y Heisenberg establecen el marco interpretativo austero que deja un vac√≠o narrativo.", icono: "üî¨"},
            
            // === PRECURSORES CULTURALES ===
            {a√±o: 1960, evento: "Alan Watts populariza el misticismo oriental", impacto: 6, tipo: "precursor", 
             desc: "Prepara el terreno cultural para la fusi√≥n ciencia-espiritualidad.", icono: "üßò"},
            
            // === CONTRACULTURA ===
            {a√±o: 1975, evento: "El Tao de la F√≠sica (Fritjof Capra)", impacto: 8, tipo: "traducci√≥n", 
             desc: "Primer bestseller que propone convergencia entre f√≠sica cu√°ntica y misticismo oriental.", icono: "üìñ"},
            {a√±o: 1975, evento: "Seminarios est de Werner Erhard", impacto: 7, tipo: "comercial", 
             desc: "Industrializaci√≥n de la 'iluminaci√≥n personal' con jerga cu√°ntica.", icono: "üíº"},
            
            // === ACADEMIZACI√ìN LIGHT ===
            {a√±o: 1990, evento: "El Yo Cu√°ntico (Danah Zohar)", impacto: 7, tipo: "pseudoacad√©mico", 
             desc: "Da respetabilidad intelectual al s√≠ntoma con credenciales del MIT.", icono: "üéì"},
            {a√±o: 1996, evento: "Esc√°ndalo Sokal", impacto: 5, tipo: "cr√≠tica", 
             desc: "Revela el vaciamiento del lenguaje cient√≠fico en estudios culturales.", icono: "‚ö°"},
            
            // === MERCANTILIZACI√ìN MASIVA ===
            {a√±o: 2000, evento: "Deepak Chopra alcanza fama global", impacto: 9, tipo: "comercial", 
             desc: "Sintetiza Ayurveda, cu√°ntica y autoayuda en imperio multimillonario.", icono: "üí∞"},
            {a√±o: 2004, evento: "Documental '¬øY t√∫ qu√© sabes?'", impacto: 8, tipo: "masivo", 
             desc: "Lleva el s√≠ntoma al cine mainstream con 16M en taquilla.", icono: "üé¨"},
            
            // === DIGITALIZACI√ìN ===
            {a√±o: 2010, evento: "Explosi√≥n de blogs y foros new age", impacto: 7, tipo: "digital", 
             desc: "El s√≠ntoma migra a internet, democratiz√°ndose y fragment√°ndose.", icono: "üíª"},
            {a√±o: 2015, evento: "Joe Dispenza viral en redes sociales", impacto: 8, tipo: "digital", 
             desc: "Neurociencia pop + cu√°ntica = retiros de $5,000 por persona.", icono: "üß†"},
            {a√±o: 2020, evento: "TikTok y #quantumhealing", impacto: 9, tipo: "viral", 
             desc: "El s√≠ntoma se atomiza en micro-contenidos de 15 segundos.", icono: "‚ö°"},
            {a√±o: 2023, evento: "ChatGPT y generaci√≥n de contenido cu√°ntico", impacto: 6, tipo: "IA", 
             desc: "IA produce contenido pseudocient√≠fico a escala industrial.", icono: "ü§ñ"},
            
            // === FUTURO PROYECTADO ===
            {a√±o: 2025, evento: "Realidad aumentada + espiritualidad cu√°ntica", impacto: 5, tipo: "futuro", 
             desc: "Proyecci√≥n: gafes AR para 'ver campos cu√°nticos'.", icono: "üëì"},
            {a√±o: 2030, evento: "Neurotecnolog√≠a + manifestaci√≥n cu√°ntica", impacto: 4, tipo: "futuro", 
             desc: "Proyecci√≥n: dispositivos que 'sincronizan ondas cerebrales con el campo cu√°ntico'.", icono: "üîÆ"}
        ];
        
        // Colores por tipo de evento
        const coloresTipo = {
            "ciencia": "#2c3e50",       // Azul oscuro
            "precursor": "#3498db",     // Azul
            "traducci√≥n": "#f39c12",    // Naranja
            "pseudoacad√©mico": "#9b59b6", // P√∫rpura
            "comercial": "#e74c3c",     // Rojo
            "cr√≠tica": "#1abc9c",       // Turquesa
            "masivo": "#e67e22",        // Naranja oscuro
            "digital": "#3498db",       // Azul
            "viral": "#f1c40f",         // Amarillo
            "IA": "#7f8c8d",            // Gris
            "futuro": "#95a5a6"         // Gris claro
        };
        
        // ================================================
        // CREAR L√çNEA DE TIEMPO INTERACTIVA
        // ================================================
        
        let timelineCreado = false;
        
        function crearTimeline() {
            if (timelineCreado) return;
            
            // Preparar datos para Plotly
            const x = hitos.map(h => h.a√±o);
            const y = hitos.map(h => h.impacto);
            const colores = hitos.map(h => coloresTipo[h.tipo]);
            const textos = hitos.map(h => 
                `<b>${h.a√±o}: ${h.evento}</b><br>` +
                `<b>Impacto:</b> ${h.impacto}/10<br>` +
                `<b>Tipo:</b> ${h.tipo}<br>` +
                `<b>Descripci√≥n:</b> ${h.desc}<br>` +
                `<i>Click para m√°s detalles</i>`
            );
            
            const traceTimeline = {
                x: x,
                y: y,
                mode: 'markers+lines+text',
                type: 'scatter',
                marker: {
                    size: hitos.map(h => 15 + h.impacto * 2), // Tama√±o seg√∫n impacto
                    color: colores,
                    symbol: hitos.map(h => {
                        // S√≠mbolos diferentes por d√©cada
                        if (h.a√±o < 1960) return 'circle';
                        if (h.a√±o < 1990) return 'diamond';
                        if (h.a√±o < 2010) return 'square';
                        return 'star';
                    }),
                    line: { width: 2, color: 'white' }
                },
                line: {
                    color: 'rgba(59, 130, 246, 0.3)',
                    width: 2,
                    dash: 'dot'
                },
                text: hitos.map(h => h.icono + ' ' + h.evento.substring(0, 20) + '...'),
                textposition: 'top center',
                textfont: { 
                    size: 10, 
                    color: '#cbd5e1',
                    family: 'Crimson Pro, serif'
                },
                hovertemplate: textos,
                customdata: hitos.map((h, i) => ({ indice: i }))
            };
            
            const layoutTimeline = {
                title: {
                    text: 'EVOLUCI√ìN TEMPORAL DEL S√çNTOMA CU√ÅNTICO (1927-2024)',
                    font: { 
                        color: '#3b82f6', 
                        size: 26,
                        family: 'Playfair Display, serif'
                    }
                },
                xaxis: {
                    title: { 
                        text: 'A√ëO', 
                        font: { color: '#e2e8f0', size: 16, family: 'Crimson Pro, serif' }
                    },
                    range: [1920, 2030],
                    gridcolor: '#334155',
                    color: '#94a3b8',
                    tickvals: [1927, 1960, 1975, 1990, 2000, 2010, 2020, 2030],
                    ticktext: ['1927<br>Copenhague', '1960<br>Precursores', '1975<br>Contracultura', '1990<br>Academizaci√≥n', 
                              '2000<br>Mercado', '2010<br>Digital', '2020<br>Viral', '2030<br>Futuro']
                },
                yaxis: {
                    title: { 
                        text: 'IMPACTO CULTURAL (1-10)', 
                        font: { color: '#e2e8f0', size: 16, family: 'Crimson Pro, serif' }
                    },
                    range: [0, 10.5],
                    gridcolor: '#334155',
                    color: '#94a3b8'
                },
                hovermode: 'closest',
                margin: { l: 80, r: 30, b: 80, t: 100 },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                showlegend: false,
                shapes: [
                    // L√≠neas verticales por d√©cada
                    {type: 'line', x0: 1920, x1: 1920, y0: 0, y1: 10, line: {color: '#475569', width: 1, dash: 'dot'}},
                    {type: 'line', x0: 1970, x1: 1970, y0: 0, y1: 10, line: {color: '#475569', width: 1, dash: 'dot'}},
                    {type: 'line', x0: 2000, x1: 2000, y0: 0, y1: 10, line: {color: '#475569', width: 1, dash: 'dot'}},
                    {type: 'line', x0: 2020, x1: 2020, y0: 0, y1: 10, line: {color: '#475569', width: 1, dash: 'dot'}}
                ],
                annotations: [
                    // Etiquetas de eras
                    {x: 1945, y: 9.5, text: 'ERA CIENT√çFICA', showarrow: false, font: {color: '#2c3e50', size: 12}},
                    {x: 1985, y: 9.5, text: 'ERA CONTRACULTURAL', showarrow: false, font: {color: '#f39c12', size: 12}},
                    {x: 2010, y: 9.5, text: 'ERA COMERCIAL', showarrow: false, font: {color: '#e74c3c', size: 12}},
                    {x: 2025, y: 9.5, text: 'ERA DIGITAL', showarrow: false, font: {color: '#3498db', size: 12}}
                ]
            };
            
            Plotly.newPlot('plotTimeline', [traceTimeline], layoutTimeline, { 
                responsive: true,
                displayModeBar: true
            });
            
            timelineCreado = true;
            
            // Generar leyenda para la l√≠nea de tiempo
            generarLeyendaTimeline();
            
            // Configurar interacci√≥n del slider
            document.getElementById('yearRange').addEventListener('input', function(e) {
                const yearStart = parseInt(e.target.value);
                const yearEnd = Math.min(yearStart + 30, 2030);
                
                document.getElementById('currentYear').textContent = `${yearStart}-${yearEnd}`;
                
                Plotly.relayout('plotTimeline', {
                    'xaxis.range': [yearStart, yearEnd]
                });
            });
            
            // Configurar click en los puntos
            document.getElementById('plotTimeline').on('plotly_click', function(data) {
                const punto = data.points[0];
                const hitoIndex = punto.customdata.indice;
                const hitoData = hitos[hitoIndex];
                
                mostrarModalHito(hitoData);
            });
        }
        
        // ================================================
        // FUNCI√ìN PARA GENERAR LEYENDA DE LA L√çNEA DE TIEMPO
        // ================================================
        
        function generarLeyendaTimeline() {
            const tiposUnicos = [...new Set(hitos.map(h => h.tipo))];
            
            const legendContainer = document.getElementById('legendTimeline');
            legendContainer.innerHTML = tiposUnicos.map(tipo => `
                <div class="legend-item">
                    <div class="legend-color" style="background-color: ${coloresTipo[tipo]};"></div>
                    <div class="legend-text">
                        <div class="legend-range">${tipo.toUpperCase()}</div>
                        <div class="legend-desc">
                            ${hitos.filter(h => h.tipo === tipo).length} evento(s)
                            ${tipo === 'futuro' ? '(proyecciones)' : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // ================================================
        // DATOS PARA EL DIAGRAMA DE RADAR
        // ================================================
        
        const perfilesRadar = {
            "cientifico": {
                nombre: "Cient√≠fico riguroso",
                ejemplo: "Niels Bohr",
                color: "#2c3e50",
                valores: {
                    rigor: 9.5,
                    alcance: 3.0,
                    comercial: 1.0,
                    influencia: 8.0,
                    duracion: 8.0,
                    especulacion: 1.0
                }
            },
            "traductor": {
                nombre: "Traductor po√©tico",
                ejemplo: "Fritjof Capra",
                color: "#f39c12",
                valores: {
                    rigor: 4.0,
                    alcance: 8.0,
                    comercial: 6.0,
                    influencia: 7.0,
                    duracion: 7.0,
                    especulacion: 6.0
                }
            },
            "comercial": {
                nombre: "Estratega comercial",
                ejemplo: "Deepak Chopra",
                color: "#e74c3c",
                valores: {
                    rigor: 1.0,
                    alcance: 10.0,
                    comercial: 10.0,
                    influencia: 9.0,
                    duracion: 9.0,
                    especulacion: 8.0
                }
            },
            "digital": {
                nombre: "Viralizador digital",
                ejemplo: "Influencer promedio",
                color: "#3498db",
                valores: {
                    rigor: 0.5,
                    alcance: 7.0,
                    comercial: 9.0,
                    influencia: 5.0,
                    duracion: 3.0,
                    especulacion: 9.5
                }
            },
            "academico": {
                nombre: "Acad√©mico light",
                ejemplo: "Danah Zohar",
                color: "#9b59b6",
                valores: {
                    rigor: 3.0,
                    alcance: 7.0,
                    comercial: 4.0,
                    influencia: 6.0,
                    duracion: 5.0,
                    especulacion: 7.0
                }
            }
        };
        
        // Dimensiones para el radar
        const dimensionesRadar = [
            {nombre: "Rigor cient√≠fico", desc: "Fidelidad al m√©todo y evidencia cient√≠fica"},
            {nombre: "Alcance medi√°tico", desc: "Capacidad de llegar a audiencias masivas"},
            {nombre: "Intencionalidad comercial", desc: "Uso del discurso para fines econ√≥micos"},
            {nombre: "Influencia en otros", desc: "Impacto en la formaci√≥n de nuevos actores"},
            {nombre: "Duraci√≥n del impacto", desc: "Persistencia temporal de su influencia"},
            {nombre: "Grado de especulaci√≥n", desc: "Uso de afirmaciones no verificables"}
        ];
        
        // ================================================
        // CREAR DIAGRAMA DE RADAR INTERACTIVO
        // ================================================
        
        let radarCreado = false;
        
        function crearRadar(perfilesSeleccionados = ["cientifico", "comercial", "digital"]) {
            const traces = perfilesSeleccionados.map(perfilKey => {
                const perfil = perfilesRadar[perfilKey];
                const valores = dimensionesRadar.map(d => perfil.valores[d.nombre.split(' ')[0].toLowerCase()]);
                
                return {
                    type: 'scatterpolar',
                    r: [...valores, valores[0]], // Cerrar el pol√≠gono
                    theta: [...dimensionesRadar.map(d => d.nombre), dimensionesRadar[0].nombre], // Cerrar el pol√≠gono
                    fill: 'toself',
                    fillcolor: `${perfil.color}40`, // 25% de opacidad
                    line: {color: perfil.color, width: 3},
                    name: perfil.nombre,
                    hovertemplate: `<b>${perfil.nombre}</b><br>%{theta}: %{r:.1f}/10<extra></extra>`,
                    text: [`Ejemplo: ${perfil.ejemplo}`],
                    textposition: 'top center'
                };
            });
            
            const layoutRadar = {
                title: {
                    text: 'PERFILES COMPARATIVOS DEL S√çNTOMA CU√ÅNTICO',
                    font: { 
                        color: '#3b82f6', 
                        size: 26,
                        family: 'Playfair Display, serif'
                    }
                },
                polar: {
                    radialaxis: {
                        visible: true,
                        range: [0, 10],
                        tickvals: [0, 2, 4, 6, 8, 10],
                        ticktext: ['0', '2', '4', '6', '8', '10'],
                        color: '#94a3b8',
                        gridcolor: '#334155',
                        linecolor: '#475569'
                    },
                    angularaxis: {
                        color: '#94a3b8',
                        gridcolor: '#334155'
                    },
                    bgcolor: 'rgba(0,0,0,0)'
                },
                margin: { l: 80, r: 80, b: 80, t: 100 },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                showlegend: true,
                legend: {
                    x: 0.8,
                    y: 0.1,
                    bgcolor: 'rgba(30, 41, 59, 0.8)',
                    bordercolor: '#3b82f6',
                    borderwidth: 1,
                    font: {color: '#e2e8f0', family: 'Crimson Pro, serif'}
                }
            };
            
            Plotly.newPlot('plotRadar', traces, layoutRadar, { 
                responsive: true,
                displayModeBar: true
            });
            
            radarCreado = true;
            
            // Generar selector de perfiles
            generarSelectorPerfiles();
            
            // Generar leyenda de dimensiones
            generarLeyendaRadar();
        }
        
        // ================================================
        // CALCULADORA IDE - L√ìGICA PRINCIPAL
        // ================================================
        
        // Casos predefinidos del ensayo
        const casosIDE = {
            chopra: {
                texto: "La curaci√≥n cu√°ntica utiliza el campo de energ√≠a universal para sanar el cuerpo a nivel celular mediante la intenci√≥n consciente.",
                ide: 9.2,
                categoria: "Fabricaci√≥n total",
                color: "#c0392b",
                dimensiones: {
                    matematica: 0.5,
                    contexto: 0.3,
                    transparencia: 1.0,
                    metafora: 9.8,
                    impacto: 9.5
                },
                analisis: "Chopra toma t√©rminos cient√≠ficos ('campo', 'cu√°ntico', 'celular') y los aplica a procesos biol√≥gicos sin evidencia. La met√°fora se presenta como mecanismo real."
            },
            dispenza: {
                texto: "La meditaci√≥n cu√°ntica permite reprogramar tu ADN y crear nuevas realidades neuronales mediante la coherencia cardiaca y el campo cu√°ntico.",
                ide: 8.8,
                categoria: "Comercializaci√≥n avanzada",
                color: "#e74c3c",
                dimensiones: {
                    matematica: 1.0,
                    contexto: 0.5,
                    transparencia: 1.5,
                    metafora: 9.5,
                    impacto: 9.0
                },
                analisis: "Mezcla neurociencia pop con jerga cu√°ntica. Ofrece transformaci√≥n biol√≥gica m√°gica sin mecanismos verificables."
            },
            capra: {
                texto: "La f√≠sica cu√°ntica y el misticismo oriental convergen en una visi√≥n hol√≠stica del universo donde todo est√° interconectado.",
                ide: 5.5,
                categoria: "Especulaci√≥n problem√°tica",
                color: "#f39c12",
                dimensiones: {
                    matematica: 3.0,
                    contexto: 4.0,
                    transparencia: 6.0,
                    metafora: 8.0,
                    impacto: 7.0
                },
                analisis: "Analog√≠as po√©ticas que confunden isomorfismo ling√º√≠stico con identidad ontol√≥gica. Bienintencionado pero epistemol√≥gicamente problem√°tico."
            },
            zohar: {
                texto: "La conciencia opera como un sistema cu√°ntico, con superposici√≥n de estados y colapso mediante la atenci√≥n.",
                ide: 5.0,
                categoria: "Especulaci√≥n acad√©mica",
                color: "#9b59b6",
                dimensiones: {
                    matematica: 4.0,
                    contexto: 3.5,
                    transparencia: 5.0,
                    metafora: 7.5,
                    impacto: 6.0
                },
                analisis: "Especulaci√≥n filos√≥fica con credenciales acad√©micas. Confunde analog√≠a sugerente con explicaci√≥n cient√≠fica."
            },
            bohr: {
                texto: "La funci√≥n de onda describe probabilidades, no realidades. La medici√≥n es un ingrediente fundamental, no un accidente.",
                ide: 0.5,
                categoria: "Ciencia rigurosa",
                color: "#2c3e50",
                dimensiones: {
                    matematica: 9.5,
                    contexto: 9.8,
                    transparencia: 9.0,
                    metafora: 1.0,
                    impacto: 8.0
                },
                analisis: "Lenguaje preciso, matem√°ticas verificables, contexto experimental claro. Austeridad epistemol√≥gica."
            },
            twitter: {
                texto: "La f√≠sica cu√°ntica lo confirma: el observador afecta lo observado. Tus pensamientos literalmente configuran tu realidad. #leydeatracci√≥n",
                ide: 9.5,
                categoria: "Fabricaci√≥n viral",
                color: "#7b241c",
                dimensiones: {
                    matematica: 0.2,
                    contexto: 0.1,
                    transparencia: 1.0,
                    metafora: 9.9,
                    impacto: 8.5
                },
                analisis: "Extracci√≥n brutal de principio complejo, descontextualizaci√≥n total, literalizaci√≥n de met√°fora, llamado emocional. Ejemplo de s√≠ntoma en estado puro."
            }
        };
        
        // Palabras clave y sus pesos para an√°lisis autom√°tico
        const palabrasClave = {
            // T√©rminos cient√≠ficos reales (bajan IDE)
            "funci√≥n de onda": -2, "ecuaci√≥n de Schr√∂dinger": -3, "decoherencia": -2, 
            "entrelazamiento": -1, "principio de incertidumbre": -1, "experimento de doble rendija": -2,
            
            // T√©rminos abusados (suben IDE)
            "crea tu realidad": 3, "ley de atracci√≥n": 3, "manifestaci√≥n": 2, "vibraci√≥n": 2,
            "energ√≠a universal": 2, "conciencia cu√°ntica": 3, "sanaci√≥n cu√°ntica": 3,
            "campo cu√°ntico": 1, "salto cu√°ntico": 1, "realidad cu√°ntica": 2,
            
            // Patrones problem√°ticos
            "literalmente": 2, "confirma": 1, "demuestra": 1, "prueba": 1,
            
            // Contexto (bajan IDE si aparecen juntos)
            "laboratorio": -1, "experimento": -1, "matem√°tica": -1, "verificaci√≥n": -1,
            
            // Intencionalidad comercial (suben IDE)
            "compra": 2, "curso": 2, "seminario": 2, "retiro": 2, "transformaci√≥n": 1
        };
        
        // ================================================
        // FUNCIONES DE INTERFAZ
        // ================================================
        
        // Funci√≥n para cambiar pesta√±as
        function openTab(tabName) {
            // Ocultar todas las pesta√±as
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            // Desactivar todos los botones
            const tabButtons = document.getElementsByClassName('tab-button');
            for (let i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove('active');
            }
            
            // Mostrar la pesta√±a seleccionada
            document.getElementById(tabName).classList.add('active');
            
            // Activar el bot√≥n correspondiente
            event.currentTarget.classList.add('active');
            
            // Redibujar gr√°ficos si es necesario
            setTimeout(() => {
                if (tabName === 'espectro3d') {
                    Plotly.Plots.resize(document.getElementById('plot3d'));
                } else if (tabName === 'influencias') {
                    Plotly.Plots.resize(document.getElementById('plotSankey'));
                } else if (tabName === 'mapa') {
                    crearMapa();
                    Plotly.Plots.resize(document.getElementById('plotMapa'));
                } else if (tabName === 'timeline') {
                    crearTimeline();
                    Plotly.Plots.resize(document.getElementById('plotTimeline'));
                } else if (tabName === 'radar') {
                    crearRadar();
                    Plotly.Plots.resize(document.getElementById('plotRadar'));
                }
            }, 100);
        }
        
        // Funci√≥n para llenar la tabla
        function populateTable() {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            
            personajes.forEach(p => {
                const row = document.createElement('tr');
                
                // Determinar color de IDE
                let ideColor = getColorByIDE(p.ide);
                
                row.innerHTML = `
                    <td><strong>${p.nombre}</strong></td>
                    <td>${p.a√±o}</td>
                    <td><span style="background: ${ideColor}; color: white; padding: 6px 12px; border-radius: 6px; font-weight: bold; display: inline-block; min-width: 50px; text-align: center;">${p.ide}/10</span></td>
                    <td>${p.alcance}/10</td>
                    <td><span style="color: #cbd5e1;">${p.categoria}</span></td>
                    <td>${p.contexto}</td>
                    <td><span style="font-style: italic; color: #94a3b8;">${p.rol}</span></td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        // Funci√≥n para generar leyenda
        function generateLegend() {
            const legendContainer = document.getElementById('legend3d');
            const legendData = [
                { range: "0-2", desc: "Ciencia rigurosa / Divulgaci√≥n leg√≠tima", color: colorPalette[0] },
                { range: "2-4", desc: "Divulgaci√≥n metaf√≥rica aceptable", color: colorPalette[2] },
                { range: "4-6", desc: "Especulaci√≥n problem√°tica", color: colorPalette[4] },
                { range: "6-8", desc: "Oportunismo espiritual / Instrumentalizaci√≥n", color: colorPalette[6] },
                { range: "8-10", desc: "Comercializaci√≥n / Fabricaci√≥n consciente", color: colorPalette[8] }
            ];
            
            legendContainer.innerHTML = legendData.map(item => `
                <div class="legend-item">
                    <div class="legend-color" style="background-color: ${item.color};"></div>
                    <div class="legend-text">
                        <div class="legend-range">IDE ${item.range}</div>
                        <div class="legend-desc">${item.desc}</div>
                    </div>
                </div>
            `).join('');
        }
        
        // Funci√≥n para generar QR
        function generateQR() {
            const url = window.location.href;
            document.getElementById('urlDisplay').textContent = url;
            
            // Limpiar contenedor previo
            document.getElementById('qrcode').innerHTML = '';
            
            // Generar nuevo QR
            new QRCode(document.getElementById('qrcode'), {
                text: url,
                width: 220,
                height: 220,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
        }
        
        // Funci√≥n para copiar URL
        function copyURL() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                const feedback = document.getElementById('copyFeedback');
                feedback.style.display = 'block';
                setTimeout(() => {
                    feedback.style.display = 'none';
                }, 3000);
            });
        }
        
        // ================================================
        // FUNCIONES PARA LA CALCULADORA IDE
        // ================================================
        
        // Funci√≥n para analizar texto autom√°ticamente
        function analizarTextoIDE() {
            const texto = document.getElementById('ideTextInput').value.trim();
            
            if (!texto) {
                alert("Por favor, ingresa un texto para analizar.");
                return;
            }
            
            // An√°lisis b√°sico (simplificado)
            let score = 5; // Punto medio por defecto
            
            // An√°lisis de palabras clave
            let indicadores = [];
            
            Object.keys(palabrasClave).forEach(palabra => {
                const regex = new RegExp(palabra, 'gi');
                const matches = texto.match(regex);
                if (matches) {
                    const peso = palabrasClave[palabra] * matches.length;
                    score += peso / 10; // Ajustar impacto
                    indicadores.push({palabra, peso, veces: matches.length});
                }
            });
            
            // Ajustar por longitud y caracter√≠sticas
            const longitud = texto.length;
            const tieneSignos = texto.includes('!') || texto.includes('#') || texto.includes('$');
            const esImperativo = /(debes|tienes que|necesitas|deber√≠as)/gi.test(texto);
            
            if (tieneSignos) score += 0.5;
            if (esImperativo) score += 0.5;
            if (longitud < 50) score += 1; // Los esl√≥ganes cortos suelen tener IDE alto
            
            // Normalizar entre 0 y 10
            score = Math.max(0, Math.min(10, score));
            
            // Determinar categor√≠a y color
            let categoria, color;
            if (score <= 2) {
                categoria = "Ciencia rigurosa";
                color = "#2c3e50";
            } else if (score <= 4) {
                categoria = "Divulgaci√≥n leg√≠tima";
                color = "#3498db";
            } else if (score <= 6) {
                categoria = "Especulaci√≥n problem√°tica";
                color = "#f39c12";
            } else if (score <= 8) {
                categoria = "Oportunismo espiritual";
                color = "#e74c3c";
            } else {
                categoria = "Fabricaci√≥n total";
                color = "#c0392b";
            }
            
            // Mostrar resultados
            mostrarResultadoIDE(score, categoria, color, texto, indicadores);
        }
        
        // Funci√≥n para mostrar resultados
        function mostrarResultadoIDE(score, categoria, color, texto, indicadores) {
            const resultadoDiv = document.getElementById('ideResult');
            const scoreElement = document.getElementById('ideScore');
            const indicator = document.getElementById('ideIndicator');
            const categoryElement = document.getElementById('ideCategory');
            const dimensionsElement = document.getElementById('ideDimensions');
            const analysisElement = document.getElementById('ideAnalysis');
            
            // Actualizar resultados
            scoreElement.textContent = score.toFixed(1) + "/10";
            scoreElement.style.color = color;
            
            // Mover indicador en la barra (score * 10% del ancho)
            indicator.style.left = `calc(${score * 10}% - 2px)`;
            
            // Actualizar categor√≠a
            categoryElement.textContent = categoria;
            categoryElement.style.background = color + "40"; // 25% opacidad
            categoryElement.style.color = color;
            
            // Generar dimensiones (simuladas para este ejemplo)
            const dimensiones = [
                { nombre: "Fidelidad matem√°tica", valor: Math.max(1, 10 - score * 0.8) },
                { nombre: "Contexto experimental", valor: Math.max(1, 10 - score * 0.9) },
                { nombre: "Transparencia", valor: Math.max(2, 10 - score * 0.7) },
                { nombre: "Literalizaci√≥n", valor: score * 0.9 },
                { nombre: "Impacto p√∫blico", valor: score * 0.7 }
            ];
            
            dimensionsElement.innerHTML = dimensiones.map(dim => `
                <div style="background: rgba(30, 41, 59, 0.8); padding: 15px; border-radius: 8px; border-left: 4px solid ${getColorForValue(dim.valor)};">
                    <div style="color: #cbd5e1; font-size: 0.9rem; margin-bottom: 5px;">${dim.nombre}</div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="flex: 1; height: 8px; background: #334155; border-radius: 4px; overflow: hidden;">
                            <div style="width: ${dim.valor * 10}%; height: 100%; background: ${getColorForValue(dim.valor)};"></div>
                        </div>
                        <span style="color: white; font-weight: bold; min-width: 30px;">${dim.valor.toFixed(1)}</span>
                    </div>
                </div>
            `).join('');
            
            // An√°lisis detallado
            let analisis = `<p><strong>Texto analizado:</strong> "${texto.substring(0, 100)}${texto.length > 100 ? '...' : ''}"</p>`;
            analisis += `<p><strong>C√°lculo del IDE:</strong> ${score.toFixed(1)}/10</p>`;
            analisis += `<p><strong>Interpretaci√≥n:</strong> ${generarInterpretacion(score, categoria)}</p>`;
            
            if (indicadores.length > 0) {
                analisis += `<p><strong>Indicadores detectados:</strong></p><ul>`;
                indicadores.forEach(ind => {
                    const efecto = ind.peso > 0 ? "‚Üë aument√≥ el IDE" : "‚Üì disminuy√≥ el IDE";
                    analisis += `<li>"${ind.palabra}" (x${ind.veces}): ${efecto}</li>`;
                });
                analisis += `</ul>`;
            }
            
            analisis += `<p style="margin-top: 15px; color: #94a3b8; font-size: 0.9rem;">Nota: Este an√°lisis es autom√°tico y simplificado. Para un an√°lisis completo, consulta los criterios detallados en el ensayo.</p>`;
            
            analysisElement.innerHTML = analisis;
            
            // Mostrar resultado
            resultadoDiv.style.display = 'block';
            resultadoDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        // Funci√≥n para cargar casos predefinidos
        function cargarCasoPredefinido(casoKey) {
            const caso = casosIDE[casoKey];
            if (!caso) return;
            
            document.getElementById('ideTextInput').value = caso.texto;
            mostrarResultadoIDE(caso.ide, caso.categoria, caso.color, caso.texto, []);
            
            // Actualizar an√°lisis con datos espec√≠ficos del caso
            document.getElementById('ideAnalysis').innerHTML = `
                <p><strong>Caso del ensayo:</strong> ${Object.keys(casosIDE).find(key => casosIDE[key] === caso)}</p>
                <p>${caso.analisis}</p>
                <p style="color: #94a3b8; font-size: 0.9rem;">Este an√°lisis est√° basado en el estudio detallado realizado en los cap√≠tulos correspondientes del ensayo.</p>
            `;
        }
        
        // Funci√≥n para cargar ejemplos r√°pidos
        function cargarEjemplo(tipo) {
            const ejemplos = {
                ej1: "Tus pensamientos crean tu realidad cu√°ntica. Visualiza lo que deseas y el universo responder√°.",
                ej2: "El campo cu√°ntico conecta todas las almas en una red de conciencia universal interdimensional.",
                ej3: "La observaci√≥n en mec√°nica cu√°ntica afecta al sistema observado bajo condiciones espec√≠ficas de laboratorio."
            };
            
            document.getElementById('ideTextInput').value = ejemplos[tipo];
            analizarTextoIDE();
        }
        
        // Funci√≥n para generar selector de perfiles
        function generarSelectorPerfiles() {
            const selectorContainer = document.getElementById('profileSelector');
            
            selectorContainer.innerHTML = Object.keys(perfilesRadar).map(key => {
                const perfil = perfilesRadar[key];
                return `
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="check_${key}" value="${key}" 
                               ${['cientifico', 'comercial', 'digital'].includes(key) ? 'checked' : ''}>
                        <label for="check_${key}" style="color: #cbd5e1; cursor: pointer;">
                            <div style="width: 12px; height: 12px; border-radius: 2px; background: ${perfil.color}; display: inline-block; margin-right: 8px;"></div>
                            ${perfil.nombre} <small style="color: #94a3b8;">(${perfil.ejemplo})</small>
                        </label>
                    </div>
                `;
            }).join('');
            
            // Configurar bot√≥n de comparaci√≥n
            document.getElementById('compareButton').addEventListener('click', function() {
                const checks = document.querySelectorAll('#profileSelector input[type="checkbox"]:checked');
                const seleccionados = Array.from(checks).map(c => c.value);
                
                if (seleccionados.length === 0) {
                    document.getElementById('comparisonFeedback').textContent = "‚ö†Ô∏è Selecciona al menos un perfil.";
                    document.getElementById('comparisonFeedback').style.color = '#f59e0b';
                    document.getElementById('comparisonFeedback').style.display = 'block';
                    return;
                }
                
                if (seleccionados.length > 3) {
                    document.getElementById('comparisonFeedback').textContent = "‚ö†Ô∏è M√°ximo 3 perfiles para comparar claramente.";
                    document.getElementById('comparisonFeedback').style.color = '#f59e0b';
                    document.getElementById('comparisonFeedback').style.display = 'block';
                    return;
                }
                
                document.getElementById('comparisonFeedback').textContent = `‚úÖ Comparando ${seleccionados.length} perfil(es)...`;
                document.getElementById('comparisonFeedback').style.color = '#10b981';
                document.getElementById('comparisonFeedback').style.display = 'block';
                
                setTimeout(() => {
                    crearRadar(seleccionados);
                    document.getElementById('comparisonFeedback').style.display = 'none';
                }, 500);
            });
        }
        
        // Funci√≥n para generar leyenda de dimensiones
        function generarLeyendaRadar() {
            const legendContainer = document.getElementById('legendRadar');
            
            legendContainer.innerHTML = dimensionesRadar.map((dim, index) => `
                <div class="legend-item">
                    <div style="width: 24px; height: 24px; border-radius: 50%; background: linear-gradient(45deg, #3b82f6, #8b5cf6); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                        ${index + 1}
                    </div>
                    <div class="legend-text">
                        <div class="legend-range">${dim.nombre}</div>
                        <div class="legend-desc">${dim.desc}</div>
                    </div>
                </div>
            `).join('');
        }
        
        // Funciones auxiliares
        function getColorForValue(valor) {
            if (valor <= 2) return "#2c3e50";
            if (valor <= 4) return "#3498db";
            if (valor <= 6) return "#f39c12";
            if (valor <= 8) return "#e74c3c";
            return "#c0392b";
        }
        
        function generarInterpretacion(score, categoria) {
            const interpretaciones = {
                "Ciencia rigurosa": "El discurso muestra fidelidad al m√©todo cient√≠fico, uso apropiado de terminolog√≠a y contexto experimental claro.",
                "Divulgaci√≥n leg√≠tima": "Comunicaci√≥n pedag√≥gica efectiva que, aunque puede usar met√°foras, preserva el n√∫cleo cient√≠fico y no induce a error.",
                "Especulaci√≥n problem√°tica": "Analog√≠as interesantes pero que cruzan l√≠mites epistemol√≥gicos sin suficiente evidencia. Riesgo de confundir met√°fora con realidad.",
                "Oportunismo espiritual": "Uso estrat√©gico del lenguaje cient√≠fico para dar autoridad a afirmaciones espirituales o de autoayuda. Descontextualizaci√≥n significativa.",
                "Fabricaci√≥n total": "Creaci√≥n deliberada de narrativas pseudocient√≠ficas. T√©rminos cient√≠ficos vaciados de contenido y presentados como mecanismos m√°gicos."
            };
            
            return interpretaciones[categoria] || "An√°lisis no disponible para esta categor√≠a.";
        }
        
        // ================================================
        // FUNCIONES PARA MODALES
        // ================================================
        
        function mostrarModalPais(paisData) {
            const modalHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 20px;">
                    <div style="background: #1e293b; padding: 30px; border-radius: 15px; max-width: 600px; width: 100%; border: 2px solid ${getColorForMap(paisData.ide_promedio)}; box-shadow: 0 20px 60px rgba(0,0,0,0.5); max-height: 90vh; overflow-y: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #3b82f6; padding-bottom: 15px;">
                            <div>
                                <h3 style="margin: 0; color: #3b82f6; font-family: 'Playfair Display', serif;">üó∫Ô∏è ${paisData.pais}</h3>
                                <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                                    <div style="width: 20px; height: 20px; border-radius: 4px; background: ${getColorForMap(paisData.ide_promedio)}; border: 2px solid white;"></div>
                                    <span style="font-weight: bold; color: #fff;">IDE promedio: ${paisData.ide_promedio}/10</span>
                                </div>
                            </div>
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-family: 'Crimson Pro', serif;">‚úï Cerrar</button>
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <h4 style="color: #10b981; margin-bottom: 10px; font-family: 'Crimson Pro', serif;">üìå Caracter√≠stica regional:</h4>
                            <p style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; border-left: 4px solid #10b981;">${paisData.caracteristica}</p>
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <h4 style="color: #f59e0b; margin-bottom: 10px; font-family: 'Crimson Pro', serif;">üë• Casos emblem√°ticos:</h4>
                            <ul style="padding-left: 20px;">
                                ${paisData.casos.map(caso => `<li style="margin-bottom: 8px; color: #cbd5e1;">${caso}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <h4 style="color: #8b5cf6; margin-bottom: 10px; font-family: 'Crimson Pro', serif;">üìñ Referencia en el ensayo:</h4>
                            <p style="color: #cbd5e1; padding: 12px; background: rgba(139, 92, 246, 0.1); border-radius: 8px; border-left: 4px solid #8b5cf6;">
                                ${paisData.cap}
                            </p>
                        </div>
                        
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 20px; border-radius: 10px; margin-top: 20px;">
                            <h4 style="color: #3b82f6; margin-bottom: 10px; font-family: 'Crimson Pro', serif;">üìä An√°lisis regional:</h4>
                            <p style="color: #94a3b8; font-size: 0.95rem; line-height: 1.6;">
                                ${generarAnalisisRegional(paisData)}
                            </p>
                        </div>
                        
                        <p style="margin-top: 20px; color: #64748b; font-size: 0.9rem; text-align: center; border-top: 1px solid #334155; padding-top: 15px;">
                            ‚ÑπÔ∏è Los datos reflejan an√°lisis cultural del ensayo "El S√≠ntoma Cu√°ntico"
                        </p>
                    </div>
                </div>
            `;
            
            const modal = document.createElement('div');
            modal.innerHTML = modalHTML;
            document.body.appendChild(modal);
        }
        
        function mostrarModalHito(hitoData) {
            const modalHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 20px;">
                    <div style="background: #1e293b; padding: 30px; border-radius: 15px; max-width: 600px; width: 100%; border: 2px solid ${coloresTipo[hitoData.tipo]}; box-shadow: 0 20px 60px rgba(0,0,0,0.5); max-height: 90vh; overflow-y: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid ${coloresTipo[hitoData.tipo]}; padding-bottom: 15px;">
                            <div>
                                <h3 style="margin: 0; color: ${coloresTipo[hitoData.tipo]}; font-family: 'Playfair Display', serif;">
                                    ${hitoData.icono} ${hitoData.a√±o}: ${hitoData.evento}
                                </h3>
                                <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                                    <div style="width: 20px; height: 20px; border-radius: 4px; background: ${coloresTipo[hitoData.tipo]}; border: 2px solid white;"></div>
                                    <span style="font-weight: bold; color: #fff;">Impacto: ${hitoData.impacto}/10</span>
                                    <span style="color: #94a3b8; margin-left: 15px;">Tipo: ${hitoData.tipo}</span>
                                </div>
                            </div>
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-family: 'Crimson Pro', serif;">‚úï Cerrar</button>
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <h4 style="color: #10b981; margin-bottom: 10px; font-family: 'Crimson Pro', serif;">üìñ Descripci√≥n:</h4>
                            <p style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; line-height: 1.6;">${hitoData.desc}</p>
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <h4 style="color: #f59e0b; margin-bottom: 10px; font-family: 'Crimson Pro', serif;">üìö Contexto hist√≥rico:</h4>
                            <p style="color: #cbd5e1; line-height: 1.6;">${obtenerContextoHistorico(hitoData.a√±o)}</p>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; margin-top: 30px; padding-top: 20px; border-top: 1px solid #334155;">
                            <div>
                                <span style="color: #64748b; font-size: 0.9rem;">‚è≥ Hito #${hitos.findIndex(h => h === hitoData) + 1} de ${hitos.length}</span>
                            </div>
                            <div>
                                ${hitoData.a√±o < 2024 ? 
                                    '<span style="color: #10b981; font-size: 0.9rem;">‚úÖ Evento hist√≥rico</span>' : 
                                    '<span style="color: #f59e0b; font-size: 0.9rem;">üîÆ Proyecci√≥n futura</span>'}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            const modal = document.createElement('div');
            modal.innerHTML = modalHTML;
            document.body.appendChild(modal);
        }
        
        // ================================================
        // FUNCIONES AUXILIARES
        // ================================================
        
        function obtenerContextoHistorico(a√±o) {
            const contextos = {
                1927: "Per√≠odo de entreguerras. La f√≠sica cu√°ntica emerge en un contexto de profunda transformaci√≥n cient√≠fica y cultural. Europa es el centro del mundo intelectual.",
                1960: "Post-guerra, baby boom, contracultura incipiente. Creciente desconfianza hacia el establishment y b√∫squeda de espiritualidades alternativas.",
                1975: "Apogeo de la contracultura, crisis del petr√≥leo, fin de la guerra de Vietnam. La espiritualidad oriental y las psicod√©licas son mainstream.",
                1990: "Ca√≠da del muro de Berl√≠n, globalizaci√≥n, auge de internet. El pensamiento posmoderno cuestiona los grandes relatos, incluida la ciencia.",
                2000: "Burbuja punto com, cultura del emprendimiento, auge del neoliberalismo. El 'yo' como proyecto de optimizaci√≥n constante.",
                2010: "Redes sociales, smartphones, econom√≠a de la atenci√≥n. La informaci√≥n se atomiza y viraliza.",
                2020: "Pandemia, aceleraci√≥n digital, crisis de sentido. Auge del wellness digital y las soluciones m√°gicas a problemas complejos.",
                2023: "IA generativa, desinformaci√≥n a escala, fatiga digital. El contenido se produce masivamente, diluyendo las fronteras entre informaci√≥n y desinformaci√≥n."
            };
            
            // Encontrar el contexto m√°s cercano
            const a√±os = Object.keys(contextos).map(Number);
            const a√±oCercano = a√±os.reduce((prev, curr) => Math.abs(curr - a√±o) < Math.abs(prev - a√±o) ? curr : prev);
            
            return contextos[a√±oCercano] || "Contexto hist√≥rico general del per√≠odo.";
        }
        
        function generarAnalisisRegional(paisData) {
            const analisis = {
                "Argentina": "El s√≠ntoma en Argentina adopta un car√°cter profundamente sincr√©tico, fusionando elementos del catolicismo popular con la new age y el discurso cu√°ntico. Esto responde a una b√∫squeda de sentido en contextos de crisis econ√≥micas recurrentes y desconfianza institucional.",
                "Estados Unidos": "Como cuna del 's√≠ntoma', EEUU muestra la mercantilizaci√≥n m√°s avanzada. La espiritualidad cu√°ntica se integra al modelo de negocio del wellness, creando un mercado global donde el discurso cient√≠fico es instrumentalizado para fines comerciales.",
                "India": "La f√≠sica cu√°ntica regresa a India con credenciales occidentales, creando una 'espiritualidad cient√≠fica' que valida tradiciones locales para una clase media globalizada. Es un ejemplo de reimportaci√≥n cultural con valor agregado de prestigio.",
                "Alemania": "El s√≠ntoma alem√°n se caracteriza por su sistematicidad casi burocr√°tica. Se ofrecen certificados, cursos estructurados y sistemas cerrados de pensamiento que atraen a profesionales que buscan espiritualidad sin abandonar el rigor aparente.",
                "Brasil": "La plasticidad sincr√©tica brasile√±a absorbe el s√≠ntoma sin trauma, mezcl√°ndolo con espiritismo, candombl√© y teolog√≠a de la prosperidad. La pregunta pragm√°tica '¬øfunciona?' domina sobre la coherencia epistemol√≥gica.",
                "Rusia": "Tras el colapso del materialismo dial√©ctico sovi√©tico, el s√≠ntoma ofrece un nuevo metarrelato totalizador. La cu√°ntica se fusiona con el misticismo eslavo, creando sistemas como el 'Transurfing' que prometen control m√°gico sobre una realidad percibida como ca√≥tica."
            };
            
            return analisis[paisData.pais] || `El s√≠ntoma cu√°ntico en ${paisData.pais} presenta caracter√≠sticas √∫nicas que reflejan su contexto hist√≥rico, social y cultural espec√≠fico.`;
        }
        
        // ================================================
        // INICIALIZACI√ìN
        // ================================================
        
        document.addEventListener('DOMContentLoaded', function() {
            // Crear gr√°fico 3D
            Plotly.newPlot('plot3d', [trace3d], layout3d, { 
                responsive: true,
                displayModeBar: true,
                modeBarButtonsToAdd: ['drawline', 'drawopenpath', 'drawclosedpath', 'drawcircle', 'drawrect', 'eraseshape']
            });
            
            // Crear gr√°fico Sankey
            Plotly.newPlot('plotSankey', [traceSankey], layoutSankey, { responsive: true });
            
            // Llenar tabla
            populateTable();
            
            // Generar leyenda
            generateLegend();
            
            // Generar QR
            generateQR();
            
            // Redimensionar gr√°ficos al cambiar tama√±o de ventana
            window.addEventListener('resize', function() {
                Plotly.Plots.resize(document.getElementById('plot3d'));
                Plotly.Plots.resize(document.getElementById('plotSankey'));
                if (mapaCreado) Plotly.Plots.resize(document.getElementById('plotMapa'));
                if (timelineCreado) Plotly.Plots.resize(document.getElementById('plotTimeline'));
                if (radarCreado) Plotly.Plots.resize(document.getElementById('plotRadar'));
            });
            
            // Interactividad para el gr√°fico 3D
            document.getElementById('plot3d').on('plotly_click', function(data) {
                const punto = data.points[0];
                const persona = datosGrafico[punto.pointIndex];
                
                // Crear modal con informaci√≥n detallada
                const modalHTML = `
                    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 20px;">
                        <div style="background: #1e293b; padding: 30px; border-radius: 15px; max-width: 500px; width: 100%; border: 2px solid ${persona.color}; box-shadow: 0 20px 60px rgba(0,0,0,0.5);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h3 style="margin: 0; color: #3b82f6; font-family: 'Playfair Display', serif;">üìñ ${persona.nombre}</h3>
                                <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-family: 'Crimson Pro', serif;">Cerrar</button>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <div style="width: 20px; height: 20px; border-radius: 4px; background: ${persona.color}; border: 2px solid white;"></div>
                                    <span style="font-weight: bold; color: #fff;">IDE: ${persona.ide}/10</span>
                                </div>
                                
                                <p><strong>A√±o de impacto:</strong> ${persona.a√±o}</p>
                                <p><strong>Alcance cultural:</strong> ${persona.alcance}/10</p>
                                <p><strong>Contexto:</strong> ${persona.contexto}</p>
                                <p><strong>Categor√≠a:</strong> ${persona.categoria}</p>
                            </div>
                            
                            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin-top: 15px;">
                                <p style="margin: 0; color: #cbd5e1; font-style: italic;">"${persona.rol}"</p>
                            </div>
                            
                            <p style="margin-top: 20px; color: #94a3b8; font-size: 0.9rem;">
                                Este personaje se analiza en detalle en el ensayo "El S√≠ntoma Cu√°ntico".
                            </p>
                        </div>
                    </div>
                `;
                
                const modal = document.createElement('div');
                modal.innerHTML = modalHTML;
                document.body.appendChild(modal);
            });
        });
    </script>
</body>
</html>