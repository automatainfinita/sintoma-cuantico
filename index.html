<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espectro del S√≠ntoma Cu√°ntico - Automata Infinita</title>
    
    <!-- Fuentes de Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@300;400;600;700&family=JetBrains+Mono:wght@300;400&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    
    <!-- QR Code Generator -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <style>
        /* ===== VARIABLES Y RESET ===== */
        :root {
            --color-fondo: #0a0e17;
            --color-texto: #e2e8f0;
            --color-primario: #3b82f6;
            --color-secundario: #1e40af;
            --color-accento: #10b981;
            --color-peligro: #ef4444;
            --color-advertencia: #f59e0b;
            --color-rigor: #2c3e50;
            --color-especulacion: #f39c12;
            --color-oportunismo: #e74c3c;
            --color-comercial: #c0392b;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Crimson Pro', serif;
            background-color: var(--color-fondo);
            color: var(--color-texto);
            line-height: 1.7;
            padding: 20px;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(59, 130, 246, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(239, 68, 68, 0.05) 0%, transparent 20%);
        }
        
        /* ===== CONTENEDOR PRINCIPAL ===== */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(15, 23, 42, 0.9);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        /* ===== ENCABEZADO ===== */
        header {
            background: linear-gradient(135deg, #0c1a32 0%, #1a365d 100%);
            padding: 40px;
            border-bottom: 3px solid var(--color-primario);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(239, 68, 68, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }
        
        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3.2rem;
            color: #fff;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            letter-spacing: 0.5px;
            position: relative;
            z-index: 1;
        }
        
        .subtitle {
            font-size: 1.4rem;
            color: #a0c8ff;
            font-style: italic;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .author {
            color: #94a3b8;
            font-size: 1.1rem;
            border-left: 3px solid var(--color-primario);
            padding-left: 20px;
            margin-top: 20px;
            position: relative;
            z-index: 1;
        }
        
        /* ===== PESTA√ëAS ===== */
        .tabs {
            display: flex;
            background: #1e293b;
            border-bottom: 2px solid var(--color-primario);
            position: relative;
            z-index: 10;
        }
        
        .tab-button {
            flex: 1;
            padding: 20px;
            background: transparent;
            border: none;
            color: #cbd5e1;
            font-family: 'Crimson Pro', serif;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            text-align: center;
            letter-spacing: 0.3px;
        }
        
        .tab-button:hover {
            background: rgba(59, 130, 246, 0.1);
            color: var(--color-primario);
        }
        
        .tab-button.active {
            background: var(--color-primario);
            color: white;
            font-weight: 600;
        }
        
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: #fff;
        }
        
        /* ===== CONTENIDO DE PESTA√ëAS ===== */
        .tab-content {
            display: none;
            padding: 40px;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ===== GR√ÅFICOS ===== */
        .graph-container {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 40px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        .graph-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--color-primario), var(--color-accento));
            border-radius: 15px 15px 0 0;
        }
        
        .graph-title {
            color: var(--color-primario);
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(59, 130, 246, 0.3);
        }
        
        .graph-wrapper {
            width: 100%;
            height: 700px;
            border-radius: 10px;
            overflow: hidden;
            background: #0f172a;
        }
        
        /* ===== LEGENDA MEJORADA ===== */
        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
            padding: 25px;
            background: rgba(30, 41, 59, 0.6);
            border-radius: 12px;
            border-left: 5px solid var(--color-primario);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .legend-color {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .legend-text {
            flex: 1;
        }
        
        .legend-range {
            font-weight: bold;
            color: #fff;
            font-size: 1.1rem;
        }
        
        .legend-desc {
            color: #cbd5e1;
            font-size: 0.95rem;
        }
        
        /* ===== TABLA ===== */
        .table-container {
            overflow-x: auto;
            margin-top: 30px;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(30, 41, 59, 0.8);
        }
        
        th {
            background: #1e293b;
            color: var(--color-primario);
            padding: 20px 15px;
            text-align: left;
            font-weight: 600;
            font-family: 'Playfair Display', serif;
            border-bottom: 2px solid var(--color-primario);
        }
        
        td {
            padding: 18px 15px;
            border-bottom: 1px solid rgba(100, 116, 139, 0.3);
            transition: background 0.3s ease;
        }
        
        tr:hover td {
            background: rgba(59, 130, 246, 0.1);
        }
        
        tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.03);
        }
        
        /* ===== SECCI√ìN QR ===== */
        .qr-section {
            text-align: center;
            padding: 50px;
            margin-top: 40px;
            background: linear-gradient(135deg, rgba(12, 26, 50, 0.9) 0%, rgba(26, 54, 93, 0.9) 100%);
            border-radius: 20px;
            border: 2px solid var(--color-primario);
            position: relative;
            overflow: hidden;
        }
        
        .qr-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 10% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(16, 185, 129, 0.1) 0%, transparent 40%);
            pointer-events: none;
        }
        
        .qr-container {
            display: inline-block;
            padding: 25px;
            background: white;
            border-radius: 15px;
            margin: 25px 0;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
            position: relative;
            z-index: 2;
        }
        
        .url-display {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            margin: 20px auto;
            max-width: 600px;
            word-break: break-all;
            border: 1px solid var(--color-primario);
            position: relative;
            z-index: 2;
        }
        
        .copy-button {
            padding: 12px 30px;
            background: var(--color-primario);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Crimson Pro', serif;
            font-size: 1rem;
            transition: all 0.3s ease;
            margin-top: 10px;
            position: relative;
            z-index: 2;
        }
        
        .copy-button:hover {
            background: var(--color-secundario);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }
        
        /* ===== FOOTER ===== */
        footer {
            text-align: center;
            padding: 40px;
            margin-top: 40px;
            border-top: 1px solid rgba(100, 116, 139, 0.3);
            color: #94a3b8;
            font-size: 0.95rem;
            position: relative;
        }
        
        footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--color-primario), transparent);
        }
        
        /* ===== NOTAS Y TOOLTIPS ===== */
        .note {
            background: rgba(59, 130, 246, 0.1);
            border-left: 4px solid var(--color-primario);
            padding: 20px;
            margin: 25px 0;
            border-radius: 0 10px 10px 0;
            font-size: 1rem;
        }
        
        .note-title {
            color: var(--color-primario);
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 1024px) {
            h1 { font-size: 2.5rem; }
            .graph-wrapper { height: 600px; }
            .tabs { flex-direction: column; }
            .tab-button { padding: 15px; }
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            header { padding: 30px 20px; }
            h1 { font-size: 2rem; }
            .subtitle { font-size: 1.1rem; }
            .graph-wrapper { height: 500px; }
            .tab-content { padding: 20px; }
            .legend-grid { grid-template-columns: 1fr; }
        }
        
        /* ===== SCROLLBAR PERSONALIZADA ===== */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1e293b;
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--color-primario);
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--color-secundario);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ENCABEZADO -->
        <header>
            <h1>üìä Espectro del S√≠ntoma Cu√°ntico</h1>
            <p class="subtitle">Visualizaci√≥n interactiva para el ensayo de Automata Infinita</p>
            <p class="subtitle">"El S√≠ntoma Cu√°ntico: Deseo, Met√°fora y B√∫squeda de Sentido en la Era Digital"</p>
            <p class="author">Investigaci√≥n cultural y an√°lisis epistemol√≥gico | Edici√≥n especial con datos extendidos</p>
        </header>
        
        <!-- PESTA√ëAS -->
        <div class="tabs">
            <button class="tab-button active" onclick="openTab('espectro3d')">üåå Espectro 3D</button>
            <button class="tab-button" onclick="openTab('influencias')">üï∏Ô∏è Red de Influencias</button>
            <button class="tab-button" onclick="openTab('tabla')">üìã Tabla Completa</button>
            <button class="tab-button" onclick="openTab('qr')">üîó Compartir</button>
        </div>
        
        <!-- PESTA√ëA 1: ESPECTRO 3D -->
        <div id="espectro3d" class="tab-content active">
            <div class="graph-container">
                <div class="graph-title">
                    üìà Espectro 3D del S√≠ntoma Cu√°ntico (1927-2024)
                </div>
                
                <div class="note">
                    <div class="note-title">üéØ C√≥mo leer este gr√°fico:</div>
                    <p><strong>Eje X (A√±o):</strong> Momento de m√°ximo impacto cultural del personaje.</p>
                    <p><strong>Eje Y (IDE):</strong> √çndice de Desviaci√≥n Epistemol√≥gica (0 = ciencia rigurosa, 10 = fabricaci√≥n completa).</p>
                    <p><strong>Eje Z (Alcance):</strong> Influencia cultural alcanzada (1 = nicho, 10 = global).</p>
                    <p><strong>Tama√±o del punto:</strong> Alcance cultural multiplicado.</p>
                    <p><strong>Color:</strong> Nivel de IDE (ver leyenda abajo).</p>
                </div>
                
                <div class="graph-wrapper" id="plot3d"></div>
            </div>
            
            <!-- LEGENDA MEJORADA -->
            <div class="legend-grid" id="legend3d">
                <!-- Se llena con JavaScript -->
            </div>
        </div>
        
        <!-- PESTA√ëA 2: RED DE INFLUENCIAS -->
        <div id="influencias" class="tab-content">
            <div class="graph-container">
                <div class="graph-title">
                    üï∏Ô∏è Red de Influencias: Qui√©n Aliment√≥ a Qui√©n
                </div>
                
                <div class="note">
                    <div class="note-title">üîç C√≥mo leer este gr√°fico:</div>
                    <p><strong>Nodos (rect√°ngulos):</strong> Personajes clave en la historia del s√≠ntoma.</p>
                    <p><strong>Flujos (conexiones):</strong> Direcci√≥n e intensidad de la influencia entre personajes.</p>
                    <p><strong>Ancho de conexi√≥n:</strong> Intensidad de la influencia (valor 1-10).</p>
                </div>
                
                <div class="graph-wrapper" id="plotSankey"></div>
            </div>
            
            <div class="note">
                <div class="note-title">‚ö° Din√°mica de contagio cultural:</div>
                <p>Este diagrama Sankey muestra c√≥mo las ideas migraron de un dominio a otro, transform√°ndose en el proceso. Observe c√≥mo el <strong>rigor austero de Copenhague</strong> (izquierda) se transforma en <strong>mercanc√≠a espiritual digital</strong> (derecha) a trav√©s de intermediarios clave. Las conexiones m√°s gruesas indican influencias m√°s determinantes en la evoluci√≥n del s√≠ntoma.</p>
            </div>
        </div>
        
        <!-- PESTA√ëA 3: TABLA COMPLETA -->
        <div id="tabla" class="tab-content">
            <div class="graph-container">
                <div class="graph-title">
                    üìã Cat√°logo Completo del S√≠ntoma
                </div>
                
                <div class="table-container">
                    <table id="completeTable">
                        <thead>
                            <tr>
                                <th>Personaje</th>
                                <th>A√±o Pico</th>
                                <th>IDE</th>
                                <th>Alcance</th>
                                <th>Categor√≠a</th>
                                <th>Contexto</th>
                                <th>Rol/Contribuci√≥n</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- La tabla se llenar√° con JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="note">
                <div class="note-title">üìù Notas sobre la tabla:</div>
                <p>Esta tabla representa el <strong>universo de personajes analizados</strong> en el ensayo. No es exhaustiva (el fen√≥meno tiene miles de actores), pero incluye los nodos m√°s significativos en la genealog√≠a del s√≠ntoma. Los datos reflejan an√°lisis cultural y no pretenden ser juicios legales sobre intencionalidad individual.</p>
            </div>
        </div>
        
        <!-- PESTA√ëA 4: QR Y COMPARTIR -->
        <div id="qr" class="tab-content">
            <div class="graph-container">
                <div class="graph-title">
                    üîó Compartir esta Visualizaci√≥n
                </div>
                
                <div class="qr-section">
                    <p style="font-size: 1.2rem; margin-bottom: 20px; color: #a0c8ff;">
                        Escanea este c√≥digo QR para acceder a esta visualizaci√≥n interactiva desde cualquier dispositivo m√≥vil.
                    </p>
                    
                    <div class="qr-container">
                        <div id="qrcode"></div>
                    </div>
                    
                    <div style="margin: 30px 0;">
                        <p style="color: #fff; font-weight: bold; margin-bottom: 15px; font-size: 1.1rem;">
                            üìã URL directa:
                        </p>
                        <div class="url-display" id="urlDisplay">Cargando URL...</div>
                        
                        <button onclick="copyURL()" class="copy-button">
                            üìã Copiar URL al portapapeles
                        </button>
                        
                        <p id="copyFeedback" style="margin-top: 15px; color: #10b981; display: none;">
                            ‚úÖ ¬°URL copiada al portapapeles!
                        </p>
                    </div>
                    
                    <div class="note" style="background: rgba(255, 255, 255, 0.1); max-width: 800px; margin: 0 auto;">
                        <div class="note-title">üåê Uso acad√©mico y citaci√≥n:</div>
                        <p>Si utilizas estas visualizaciones en trabajos acad√©micos o publicaciones, por favor cita como:</p>
                        <p style="font-family: 'JetBrains Mono', monospace; background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; margin-top: 15px; font-size: 0.95rem;">
                            Automata Infinita. (2024). <em>Visualizaci√≥n del Espectro del S√≠ntoma Cu√°ntico</em>. Recuperado de [URL actual]
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- FOOTER -->
        <footer>
            <p>¬© 2024 Automata Infinita - "El S√≠ntoma Cu√°ntico: Deseo, Met√°fora y B√∫squeda de Sentido en la Era Digital"</p>
            <p style="margin-top: 10px; color: #64748b; font-size: 0.9rem;">
                Esta visualizaci√≥n acompa√±a al ensayo de investigaci√≥n cultural. Los datos representan an√°lisis epistemol√≥gico y no pretenden ser juicios legales.
            </p>
            <p style="margin-top: 20px;">
                <a href="javascript:void(0)" onclick="openTab('espectro3d')" style="color: #3b82f6; text-decoration: none; margin: 0 10px;">Espectro 3D</a> | 
                <a href="javascript:void(0)" onclick="openTab('influencias')" style="color: #3b82f6; text-decoration: none; margin: 0 10px;">Red de Influencias</a> | 
                <a href="javascript:void(0)" onclick="openTab('tabla')" style="color: #3b82f6; text-decoration: none; margin: 0 10px;">Tabla Completa</a> | 
                <a href="javascript:void(0)" onclick="openTab('qr')" style="color: #3b82f6; text-decoration: none; margin: 0 10px;">Compartir</a>
            </p>
            <p style="margin-top: 15px; font-size: 0.85rem; color: #475569;">
                Visualizaci√≥n creada con Plotly.js | Publicaci√≥n recomendada: GitHub Pages | Fuentes: Google Fonts
            </p>
        </footer>
    </div>

    <script>
        // ================================================
        // CONFIGURACI√ìN INICIAL
        // ================================================
        
        // Paleta de colores por IDE (√çndice de Desviaci√≥n Epistemol√≥gica)
        const colorPalette = {
            0: '#2c3e50',   // Rigor cient√≠fico
            2: '#3498db',   // Divulgaci√≥n leg√≠tima
            4: '#f39c12',   // Especulaci√≥n problem√°tica
            6: '#e74c3c',   // Oportunismo espiritual
            8: '#c0392b',   // Comercializaci√≥n
            10: '#7b241c'   // Fabricaci√≥n total
        };
        
        // Funci√≥n para obtener color por IDE
        function getColorByIDE(ide) {
            if (ide <= 2) return colorPalette[0];
            if (ide <= 4) return colorPalette[2];
            if (ide <= 6) return colorPalette[4];
            if (ide <= 8) return colorPalette[6];
            if (ide <= 10) return colorPalette[8];
            return colorPalette[10];
        }
        
        // Funci√≥n de jitter mejorada (sin superposiciones)
        function calcularJitter(personaje, index) {
            // Crear un hash √∫nico basado en el nombre
            const nombreHash = personaje.nombre.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
            
            // Jitter en X (a√±o): ¬±0.8 a√±os
            const jitterX = (nombreHash % 200) / 200 - 0.5;
            
            // Jitter en Y (IDE): ¬±0.4 puntos
            const jitterY = ((nombreHash * 17) % 200) / 200 - 0.5;
            
            // Jitter en Z (alcance): ¬±0.3 puntos
            const jitterZ = ((nombreHash * 31) % 200) / 200 - 0.5;
            
            return {
                x: personaje.a√±o + jitterX * 0.8,
                y: personaje.ide + jitterY * 0.4,
                z: personaje.alcance + jitterZ * 0.3
            };
        }
        
        // ================================================
        // DATOS COMPLETOS - TODOS LOS PERSONAJES
        // ================================================
        
        const personajes = [
            // === FUNDADORES / CIENCIA RIGUROSA ===
            {id: 0, nombre: "Niels Bohr", a√±o: 1927, ide: 0.5, alcance: 3, categoria: "Cient√≠fico fundador", contexto: "Dinamarca", rol: "Interpretaci√≥n de Copenhague"},
            {id: 1, nombre: "Werner Heisenberg", a√±o: 1927, ide: 0.5, alcance: 3, categoria: "Cient√≠fico fundador", contexto: "Alemania", rol: "Principio de incertidumbre"},
            
            // === PRECURSORES CULTURALES ===
            {id: 2, nombre: "Alan Watts", a√±o: 1960, ide: 2, alcance: 8, categoria: "Popularizador m√≠stico", contexto: "EEUU/Reino Unido", rol: "Puente Oriente/Occidente"},
            {id: 3, nombre: "Gregory Bateson", a√±o: 1970, ide: 2.5, alcance: 7, categoria: "Pensador sist√©mico", contexto: "EEUU/Reino Unido", rol: "Ecolog√≠a de la mente"},
            
            // === CONTRACULTURA CALIFORNIANA ===
            {id: 4, nombre: "Fritjof Capra", a√±o: 1975, ide: 5, alcance: 8, categoria: "Traductor po√©tico", contexto: "Austria/EEUU", rol: "El Tao de la F√≠sica"},
            {id: 5, nombre: "Jack Sarfatti", a√±o: 1975, ide: 6.2, alcance: 5, categoria: "F√≠sico marginal", contexto: "EEUU", rol: "Telepat√≠a cu√°ntica"},
            {id: 6, nombre: "Fred Alan Wolf", a√±o: 1975, ide: 6.8, alcance: 5, categoria: "F√≠sico marginal", contexto: "EEUU", rol: "El Universo So√±ado"},
            
            // === OPORTUNISTAS ESPIRITUALES ===
            {id: 7, nombre: "Timothy Leary", a√±o: 1970, ide: 7.5, alcance: 8, categoria: "Oportunista espiritual", contexto: "EEUU", rol: "Psicodelia y cu√°ntica"},
            {id: 8, nombre: "Richard Alpert (Ram Dass)", a√±o: 1971, ide: 7.2, alcance: 7, categoria: "Oportunista espiritual", contexto: "EEUU", rol: "Psicolog√≠a + espiritualidad"},
            {id: 9, nombre: "Maharishi Mahesh Yogi", a√±o: 1975, ide: 6.5, alcance: 8, categoria: "Cientifista m√≠stico", contexto: "India/Global", rol: "TM + estudios cu√°nticos"},
            
            // === COMERCIALIZACI√ìN (80s-90s) ===
            {id: 10, nombre: "Werner Erhard", a√±o: 1978, ide: 7.5, alcance: 8, categoria: "Instrumentalista", contexto: "EEUU", rol: "est - Iluminaci√≥n industrial"},
            {id: 11, nombre: "Danah Zohar", a√±o: 1990, ide: 5.5, alcance: 7, categoria: "Especuladora acad√©mica", contexto: "EEUU/Reino Unido", rol: "El Yo Cu√°ntico"},
            {id: 12, nombre: "Deepak Chopra", a√±o: 2000, ide: 9, alcance: 10, categoria: "Estratega comercial", contexto: "India/EEUU", rol: "Imperio wellness cu√°ntico"},
            
            // === SIGLO XXI - ESPECULADORES ===
            {id: 13, nombre: "Joe Dispenza", a√±o: 2015, ide: 8.5, alcance: 9, categoria: "Neurocu√°ntico", contexto: "EEUU", rol: "Meditaci√≥n + plasticidad cerebral"},
            {id: 14, nombre: "Gregg Braden", a√±o: 2010, ide: 7.5, alcance: 8, categoria: "Espiritualista c√≥smico", contexto: "EEUU", rol: "El campo divino"},
            {id: 15, nombre: "Bruce Lipton", a√±o: 2005, ide: 6.5, alcance: 7, categoria: "Bi√≥logo especulativo", contexto: "EEUU", rol: "Biolog√≠a de la creencia"},
            {id: 16, nombre: "Lynne McTaggart", a√±o: 2007, ide: 5.5, alcance: 6, categoria: "Periodista cient√≠fica", contexto: "EEUU", rol: "El Campo - experimentos"},
            {id: 17, nombre: "Amit Goswami", a√±o: 2005, ide: 5.5, alcance: 6, categoria: "Acad√©mico idealista", contexto: "India/EEUU", rol: "Idealismo cu√°ntico"},
            
            // === LATINOAM√âRICA ===
            {id: 18, nombre: "Claudio Mar√≠a Dom√≠nguez", a√±o: 2015, ide: 8, alcance: 7, categoria: "New age medi√°tico", contexto: "Argentina", rol: "Sincretismo cat√≥lico-new age-cu√°ntico"},
            {id: 19, nombre: "M√°ximo Rabino", a√±o: 2018, ide: 7.5, alcance: 5, categoria: "Cabalista", contexto: "Argentina", rol: "C√°bala + f√≠sica moderna"},
            {id: 20, nombre: "V√≠ctor Brossa", a√±o: 2015, ide: 8.2, alcance: 6, categoria: "Artista sanador", contexto: "Espa√±a/Argentina", rol: "Sanaci√≥n cu√°ntica"},
            
            // === DIGITAL NATIVO ===
            {id: 21, nombre: "Influencer promedio", a√±o: 2023, ide: 9.5, alcance: 7, categoria: "Viralizador digital", contexto: "Global", rol: "Coaching digital - manifestaci√≥n"}
        ];
        
        // ================================================
        // PREPARAR DATOS PARA GR√ÅFICO 3D
        // ================================================
        
        const datosGrafico = personajes.map((p, i) => {
            const jitter = calcularJitter(p, i);
            return {
                x: jitter.x,
                y: jitter.y,
                z: jitter.z,
                nombre: p.nombre,
                a√±o: p.a√±o,
                ide: p.ide,
                alcance: p.alcance,
                categoria: p.categoria,
                contexto: p.contexto,
                rol: p.rol,
                color: getColorByIDE(p.ide),
                size: Math.max(15, p.alcance * 4)
            };
        });
        
        // ================================================
        // GR√ÅFICO 3D MEJORADO
        // ================================================
        
        const trace3d = {
            x: datosGrafico.map(d => d.x),
            y: datosGrafico.map(d => d.y),
            z: datosGrafico.map(d => d.z),
            mode: 'markers+text',
            type: 'scatter3d',
            marker: {
                size: datosGrafico.map(d => d.size),
                color: datosGrafico.map(d => d.color),
                opacity: 0.9,
                symbol: 'circle',
                line: { color: 'white', width: 1.5 }
            },
            text: datosGrafico.map(d => d.nombre),
            textposition: 'top center',
            textfont: { 
                size: 12, 
                color: datosGrafico.map(d => d.ide > 7 ? '#fff' : '#333'),
                family: 'Crimson Pro, serif'
            },
            hovertemplate: `
                <b>%{text}</b><br>
                <br>
                <b>A√±o:</b> %{customdata.a√±o}<br>
                <b>IDE:</b> %{customdata.ide}/10<br>
                <b>Alcance:</b> %{customdata.alcance}/10<br>
                <br>
                <b>Contexto:</b> %{customdata.contexto}<br>
                <b>Categor√≠a:</b> %{customdata.categoria}<br>
                <br>
                <i>%{customdata.rol}</i>
                <extra></extra>
            `,
            customdata: datosGrafico.map(d => ({
                a√±o: d.a√±o,
                ide: d.ide.toFixed(1),
                alcance: d.alcance,
                contexto: d.contexto,
                categoria: d.categoria,
                rol: d.rol
            }))
        };
        
        const layout3d = {
            title: {
                text: 'ESPECTRO 3D: DEL RIGOR A LA MALVERSACI√ìN (1927-2024)',
                font: { 
                    color: '#3b82f6', 
                    size: 26,
                    family: 'Playfair Display, serif'
                }
            },
            scene: {
                xaxis: { 
                    title: { 
                        text: 'A√ëO DE IMPACTO CULTURAL', 
                        font: { color: '#e2e8f0', size: 16, family: 'Crimson Pro, serif' }
                    },
                    range: [1910, 2030],
                    gridcolor: '#334155',
                    color: '#94a3b8',
                    backgroundcolor: '#0f172a',
                    tickvals: [1927, 1960, 1975, 1990, 2005, 2020, 2025],
                    ticktext: ['1927<br>Copenhague', '1960<br>Watts', '1975<br>Capra', '1990<br>Zohar', '2005<br>Lipton', '2020<br>Digital', '2025<br>Futuro']
                },
                yaxis: { 
                    title: { 
                        text: '√çNDICE DE DESVIACI√ìN EPISTEMOL√ìGICA (IDE)', 
                        font: { color: '#e2e8f0', size: 16, family: 'Crimson Pro, serif' }
                    },
                    range: [0, 10.5],
                    gridcolor: '#334155',
                    color: '#94a3b8',
                    backgroundcolor: '#0f172a',
                    tickvals: [0, 2, 4, 6, 8, 10],
                    ticktext: ['RIGOR<br>CIENT√çFICO', 'DIVULGACI√ìN', 'ESPECULACI√ìN', 'OPORTUNISMO', 'COMERCIAL', 'FABRICACI√ìN']
                },
                zaxis: { 
                    title: { 
                        text: 'ALCANCE CULTURAL (1-10)', 
                        font: { color: '#e2e8f0', size: 16, family: 'Crimson Pro, serif' }
                    },
                    range: [0, 11],
                    gridcolor: '#334155',
                    color: '#94a3b8',
                    backgroundcolor: '#0f172a'
                },
                bgcolor: '#0f172a',
                camera: { 
                    eye: { x: 1.8, y: 1.8, z: 1.3 },
                    up: { x: 0, y: 0, z: 1 },
                    center: { x: 0, y: 0, z: 0 }
                }
            },
            margin: { l: 0, r: 0, b: 0, t: 100 },
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            hovermode: 'closest',
            showlegend: false
        };
        
        // ================================================
        // RED DE INFLUENCIAS (SANKEY)
        // ================================================
        
        const nodosSankey = [
            { nombre: "Niels Bohr", categoria: "Cient√≠fico fundador" },
            { nombre: "Alan Watts", categoria: "Popularizador m√≠stico" },
            { nombre: "Fritjof Capra", categoria: "Traductor po√©tico" },
            { nombre: "Jack Sarfatti", categoria: "F√≠sico marginal" },
            { nombre: "Timothy Leary", categoria: "Oportunista espiritual" },
            { nombre: "Maharishi Mahesh Yogi", categoria: "Cientifista m√≠stico" },
            { nombre: "Werner Erhard", categoria: "Instrumentalista" },
            { nombre: "Danah Zohar", categoria: "Especuladora acad√©mica" },
            { nombre: "Deepak Chopra", categoria: "Estratega comercial" },
            { nombre: "Joe Dispenza", categoria: "Neurocu√°ntico" },
            { nombre: "Claudio M. Dom√≠nguez", categoria: "New age medi√°tico" },
            { nombre: "Influencer promedio", categoria: "Viralizador digital" }
        ];
        
        const traceSankey = {
            type: "sankey",
            orientation: "h",
            node: {
                pad: 20,
                thickness: 25,
                line: { color: "black", width: 0.8 },
                label: nodosSankey.map(n => n.nombre),
                color: nodosSankey.map(n => {
                    const persona = personajes.find(p => p.nombre.includes(n.nombre.split(' ')[0]));
                    return persona ? getColorByIDE(persona.ide) : '#7f8c8d';
                }),
                hoverinfo: 'all',
                hovertemplate: '<b>%{label}</b><extra></extra>'
            },
            link: {
                source: [0, 0, 1, 2, 3, 4, 5, 6, 8, 9, 10],
                target: [2, 7, 8, 8, 8, 9, 9, 9, 10, 10, 11],
                value: [5, 3, 4, 6, 5, 4, 3, 6, 7, 8, 9],
                color: 'rgba(100, 100, 100, 0.3)',
                hovertemplate: 'Influencia: %{value}/10<extra></extra>'
            },
            textfont: { color: '#e2e8f0', size: 13, family: 'Crimson Pro, serif' }
        };
        
        const layoutSankey = {
            title: {
                text: "RED DE INFLUENCIAS CLAVE EN LA EVOLUCI√ìN DEL S√çNTOMA",
                font: { color: '#3b82f6', size: 24, family: 'Playfair Display, serif' }
            },
            font: { color: '#e2e8f0', size: 13, family: 'Crimson Pro, serif' },
            width: 1200,
            height: 700,
            margin: { l: 50, r: 50, b: 50, t: 90 },
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)'
        };
        
        // ================================================
        // FUNCIONES DE INTERFAZ
        // ================================================
        
        // Funci√≥n para cambiar pesta√±as
        function openTab(tabName) {
            // Ocultar todas las pesta√±as
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            // Desactivar todos los botones
            const tabButtons = document.getElementsByClassName('tab-button');
            for (let i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove('active');
            }
            
            // Mostrar la pesta√±a seleccionada
            document.getElementById(tabName).classList.add('active');
            
            // Activar el bot√≥n correspondiente
            event.currentTarget.classList.add('active');
            
            // Redibujar gr√°ficos si es necesario
            if (tabName === 'espectro3d') {
                setTimeout(() => Plotly.Plots.resize(document.getElementById('plot3d')), 100);
            } else if (tabName === 'influencias') {
                setTimeout(() => Plotly.Plots.resize(document.getElementById('plotSankey')), 100);
            }
        }
        
        // Funci√≥n para llenar la tabla
        function populateTable() {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            
            personajes.forEach(p => {
                const row = document.createElement('tr');
                
                // Determinar color de IDE
                let ideColor = getColorByIDE(p.ide);
                
                row.innerHTML = `
                    <td><strong>${p.nombre}</strong></td>
                    <td>${p.a√±o}</td>
                    <td><span style="background: ${ideColor}; color: white; padding: 6px 12px; border-radius: 6px; font-weight: bold; display: inline-block; min-width: 50px; text-align: center;">${p.ide}/10</span></td>
                    <td>${p.alcance}/10</td>
                    <td><span style="color: #cbd5e1;">${p.categoria}</span></td>
                    <td>${p.contexto}</td>
                    <td><span style="font-style: italic; color: #94a3b8;">${p.rol}</span></td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        // Funci√≥n para generar leyenda
        function generateLegend() {
            const legendContainer = document.getElementById('legend3d');
            const legendData = [
                { range: "0-2", desc: "Ciencia rigurosa / Divulgaci√≥n leg√≠tima", color: colorPalette[0] },
                { range: "2-4", desc: "Divulgaci√≥n metaf√≥rica aceptable", color: colorPalette[2] },
                { range: "4-6", desc: "Especulaci√≥n problem√°tica", color: colorPalette[4] },
                { range: "6-8", desc: "Oportunismo espiritual / Instrumentalizaci√≥n", color: colorPalette[6] },
                { range: "8-10", desc: "Comercializaci√≥n / Fabricaci√≥n consciente", color: colorPalette[8] }
            ];
            
            legendContainer.innerHTML = legendData.map(item => `
                <div class="legend-item">
                    <div class="legend-color" style="background-color: ${item.color};"></div>
                    <div class="legend-text">
                        <div class="legend-range">IDE ${item.range}</div>
                        <div class="legend-desc">${item.desc}</div>
                    </div>
                </div>
            `).join('');
        }
        
        // Funci√≥n para generar QR
        function generateQR() {
            const url = window.location.href;
            document.getElementById('urlDisplay').textContent = url;
            
            // Limpiar contenedor previo
            document.getElementById('qrcode').innerHTML = '';
            
            // Generar nuevo QR
            new QRCode(document.getElementById('qrcode'), {
                text: url,
                width: 220,
                height: 220,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
        }
        
        // Funci√≥n para copiar URL
        function copyURL() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                const feedback = document.getElementById('copyFeedback');
                feedback.style.display = 'block';
                setTimeout(() => {
                    feedback.style.display = 'none';
                }, 3000);
            });
        }
        
        // ================================================
        // INICIALIZACI√ìN
        // ================================================
        
        document.addEventListener('DOMContentLoaded', function() {
            // Crear gr√°fico 3D
            Plotly.newPlot('plot3d', [trace3d], layout3d, { 
                responsive: true,
                displayModeBar: true,
                modeBarButtonsToAdd: ['drawline', 'drawopenpath', 'drawclosedpath', 'drawcircle', 'drawrect', 'eraseshape']
            });
            
            // Crear gr√°fico Sankey
            Plotly.newPlot('plotSankey', [traceSankey], layoutSankey, { responsive: true });
            
            // Llenar tabla
            populateTable();
            
            // Generar leyenda
            generateLegend();
            
            // Generar QR
            generateQR();
            
            // Redimensionar gr√°ficos al cambiar tama√±o de ventana
            window.addEventListener('resize', function() {
                Plotly.Plots.resize(document.getElementById('plot3d'));
                Plotly.Plots.resize(document.getElementById('plotSankey'));
            });
            
            // Interactividad para el gr√°fico 3D
            document.getElementById('plot3d').on('plotly_click', function(data) {
                const punto = data.points[0];
                const persona = datosGrafico[punto.pointIndex];
                
                // Crear modal con informaci√≥n detallada
                const modalHTML = `
                    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 20px;">
                        <div style="background: #1e293b; padding: 30px; border-radius: 15px; max-width: 500px; width: 100%; border: 2px solid ${persona.color}; box-shadow: 0 20px 60px rgba(0,0,0,0.5);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h3 style="margin: 0; color: #3b82f6; font-family: 'Playfair Display', serif;">üìñ ${persona.nombre}</h3>
                                <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-family: 'Crimson Pro', serif;">Cerrar</button>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <div style="width: 20px; height: 20px; border-radius: 4px; background: ${persona.color}; border: 2px solid white;"></div>
                                    <span style="font-weight: bold; color: #fff;">IDE: ${persona.ide}/10</span>
                                </div>
                                
                                <p><strong>A√±o de impacto:</strong> ${persona.a√±o}</p>
                                <p><strong>Alcance cultural:</strong> ${persona.alcance}/10</p>
                                <p><strong>Contexto:</strong> ${persona.contexto}</p>
                                <p><strong>Categor√≠a:</strong> ${persona.categoria}</p>
                            </div>
                            
                            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin-top: 15px;">
                                <p style="margin: 0; color: #cbd5e1; font-style: italic;">"${persona.rol}"</p>
                            </div>
                            
                            <p style="margin-top: 20px; color: #94a3b8; font-size: 0.9rem;">
                                Este personaje se analiza en detalle en el ensayo "El S√≠ntoma Cu√°ntico".
                            </p>
                        </div>
                    </div>
                `;
                
                const modal = document.createElement('div');
                modal.innerHTML = modalHTML;
                document.body.appendChild(modal);
            });
        });
    </script>
</body>
</html>